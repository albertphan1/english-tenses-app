<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ğŸ¦‰ English Tenses - Há»c ThÃ¬ Tiáº¿ng Anh</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦‰</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }
    
    .app-container { max-width: 800px; margin: 0 auto; position: relative; }
    
    .floating-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
    .shape { position: absolute; opacity: 0.3; animation: float 6s ease-in-out infinite; }
    .shape:nth-child(1) { top: 10%; left: 10%; font-size: 40px; }
    .shape:nth-child(2) { top: 20%; right: 15%; animation-delay: 1s; font-size: 35px; }
    .shape:nth-child(3) { bottom: 30%; left: 5%; animation-delay: 2s; font-size: 45px; }
    .shape:nth-child(4) { bottom: 15%; right: 10%; animation-delay: 3s; font-size: 38px; }
    .shape:nth-child(5) { top: 50%; left: 50%; animation-delay: 4s; font-size: 42px; }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    .sound-toggle {
      position: fixed; top: 20px; right: 20px; width: 50px; height: 50px;
      border-radius: 50%; border: none; background: rgba(255,255,255,0.95);
      font-size: 1.5rem; cursor: pointer; z-index: 100;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .sound-toggle:hover { transform: scale(1.1); }
    
    .content { position: relative; z-index: 1; }
    .screen { display: none; }
    .screen.active { display: block; }
    
    .home-screen { text-align: center; padding: 40px 20px; }
    .app-title {
      font-size: 2.5rem; font-weight: 800; color: white;
      text-shadow: 3px 3px 0 rgba(0,0,0,0.2); margin-bottom: 10px;
    }
    .app-subtitle { font-size: 1.1rem; color: rgba(255,255,255,0.9); margin-bottom: 30px; }
    .mascot { font-size: 100px; margin: 20px 0; animation: bounce 2s ease infinite; }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    .menu-buttons { display: flex; flex-direction: column; gap: 15px; max-width: 280px; margin: 0 auto; }
    .menu-btn {
      padding: 16px 28px; font-size: 1.2rem; font-weight: 700; border: none;
      border-radius: 50px; cursor: pointer; font-family: 'Nunito', sans-serif;
    }
    .menu-btn.play {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b; box-shadow: 0 6px 0 #d4904a;
    }
    .menu-btn.verbs {
      background: linear-gradient(135deg, #a8e6cf 0%, #88d8b0 100%);
      color: #2d6a4f; box-shadow: 0 6px 0 #5fa87f;
    }
    .menu-btn.learn {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #4a6572; box-shadow: 0 6px 0 #7fb8b6;
    }
    .menu-btn:hover { transform: translateY(-3px); }
    .menu-btn:active { transform: translateY(3px); }
    
    .game-header {
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(255,255,255,0.95); border-radius: 20px;
      padding: 15px 20px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;
    }
    .back-btn {
      background: #ff6b6b; color: white; border: none; padding: 10px 20px;
      border-radius: 25px; font-weight: 700; cursor: pointer; font-family: 'Nunito', sans-serif;
    }
    .back-btn:hover { background: #ee5a5a; }
    
    .progress-info { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .question-counter { font-weight: 700; color: #4a4a4a; }
    .score-display {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; padding: 8px 16px; border-radius: 20px; font-weight: 700;
    }
    .streak-display {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white; padding: 8px 16px; border-radius: 20px; font-weight: 700;
    }
    
    .progress-bar-container {
      background: rgba(255,255,255,0.3); border-radius: 10px;
      height: 10px; margin-bottom: 20px; overflow: hidden;
    }
    .progress-bar {
      height: 100%; background: linear-gradient(90deg, #f6d365 0%, #fda085 100%);
      border-radius: 10px; transition: width 0.5s ease;
    }
    
    .question-card {
      background: rgba(255,255,255,0.98); border-radius: 25px;
      padding: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    .question-type-badge {
      display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; padding: 8px 20px; border-radius: 25px;
      font-weight: 700; font-size: 0.9rem; margin-bottom: 20px;
    }
    .question-text { font-size: 1.4rem; color: #2d3748; margin-bottom: 25px; line-height: 1.4; }
    
    .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
    .options-grid.vertical { grid-template-columns: 1fr; }
    .option-btn {
      padding: 16px 20px; font-size: 1.1rem; font-weight: 600;
      border: 3px solid #e2e8f0; border-radius: 15px; background: white;
      cursor: pointer; font-family: 'Nunito', sans-serif; transition: all 0.2s;
    }
    .option-btn:hover:not(:disabled) { border-color: #667eea; background: #f7fafc; }
    .option-btn.correct { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); border-color: #48bb78; }
    .option-btn.wrong { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); border-color: #fc8181; }
    
    .explanation {
      margin-top: 20px; padding: 20px; border-radius: 15px;
      font-weight: 600; font-size: 1.1rem;
    }
    .explanation.correct { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); color: #276749; }
    .explanation.wrong { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #c53030; }
    
    .next-btn {
      display: block; width: 100%; margin-top: 20px; padding: 16px;
      font-size: 1.2rem; font-weight: 700; border: none; border-radius: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; cursor: pointer; font-family: 'Nunito', sans-serif;
    }
    .next-btn:hover { transform: translateY(-2px); }
    
    .hint-box {
      background: linear-gradient(135deg, #fff9c4 0%, #ffecd2 100%);
      padding: 15px 20px; border-radius: 15px; margin-bottom: 20px;
      font-weight: 600; color: #8b6914;
    }
    .fill-input-container { display: flex; gap: 15px; flex-wrap: wrap; }
    .fill-input {
      flex: 1; min-width: 180px; padding: 16px 20px; font-size: 1.2rem;
      border: 3px solid #e2e8f0; border-radius: 15px; font-family: 'Nunito', sans-serif;
    }
    .fill-input:focus { outline: none; border-color: #667eea; }
    .submit-btn {
      padding: 16px 30px; font-size: 1.1rem; font-weight: 700; border: none;
      border-radius: 15px; background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b; cursor: pointer; font-family: 'Nunito', sans-serif;
    }
    .submit-btn:hover { transform: scale(1.05); }
    
    .sort-hint { color: #718096; font-size: 0.9rem; margin-bottom: 15px; text-align: center; }
    .words-pool {
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
      min-height: 50px; padding: 15px; background: rgba(102,126,234,0.1);
      border-radius: 15px; margin-bottom: 20px;
    }
    .draggable-word {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; padding: 10px 18px; border-radius: 20px;
      font-weight: 700; cursor: grab; user-select: none;
      transition: all 0.2s;
    }
    .draggable-word:active { cursor: grabbing; }
    .draggable-word:hover { transform: scale(1.1); }
    .draggable-word.selected {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b; transform: scale(1.1);
    }
    .draggable-word.dragging {
      opacity: 0.5; transform: scale(1.1);
    }
    .sort-containers { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
    .sort-box {
      background: white; border: 4px dashed #cbd5e0; border-radius: 15px;
      padding: 15px; min-height: 120px; cursor: pointer;
      transition: all 0.2s;
    }
    .sort-box:hover, .sort-box.drag-over { border-color: #667eea; background: #f0f4ff; }
    .sort-box h3 { font-size: 0.95rem; margin-bottom: 10px; }
    .sort-box.present h3 { color: #38a169; }
    .sort-box.past h3 { color: #dd6b20; }
    .sorted-words { display: flex; flex-wrap: wrap; gap: 8px; }
    .sorted-word { background: #e2e8f0; padding: 8px 12px; border-radius: 12px; font-weight: 600; font-size: 0.85rem; }
    .sorted-word.correct { background: #c6f6d5; color: #276749; }
    .sorted-word.wrong { background: #fed7d7; color: #c53030; }
    
    .tf-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .tf-btn {
      padding: 20px; font-size: 1.3rem; font-weight: 700;
      border: 4px solid transparent; border-radius: 15px;
      cursor: pointer; font-family: 'Nunito', sans-serif;
    }
    .tf-btn.true { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); color: #276749; }
    .tf-btn.false { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #c53030; }
    .tf-btn:hover:not(:disabled) { transform: scale(1.05); }
    .tf-btn.correct { border-color: #48bb78; }
    .tf-btn.wrong { border-color: #fc8181; }
    
    .picture-emoji { font-size: 70px; text-align: center; margin-bottom: 20px; }
    
    .result-screen { text-align: center; padding: 30px 20px; }
    .result-card {
      background: rgba(255,255,255,0.98); border-radius: 25px;
      padding: 35px; box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    .result-title {
      font-size: 2rem; font-weight: 800; margin-bottom: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .result-emoji { font-size: 80px; margin: 15px 0; }
    .stars-display { font-size: 50px; margin: 15px 0; }
    .result-score { font-size: 1.3rem; color: #4a5568; margin-bottom: 10px; }
    .result-message { font-size: 1.1rem; color: #718096; margin-bottom: 25px; }
    .result-buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    
    .lesson-card {
      background: rgba(255,255,255,0.98); border-radius: 25px;
      padding: 25px; margin-bottom: 20px;
    }
    .lesson-title { font-size: 1.5rem; font-weight: 800; color: #2d3748; margin-bottom: 20px; }
    .tense-box { background: #f7fafc; border-radius: 15px; padding: 20px; margin-bottom: 15px; }
    .tense-box h3 { font-size: 1.2rem; margin-bottom: 10px; }
    .tense-box.present h3 { color: #38a169; }
    .tense-box.past h3 { color: #dd6b20; }
    .signal-words { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
    .signal-word { padding: 6px 14px; border-radius: 15px; font-weight: 700; font-size: 0.85rem; }
    .signal-word.present { background: #c6f6d5; color: #276749; }
    .signal-word.past { background: #feebc8; color: #c05621; }
    .examples { background: white; border-radius: 10px; padding: 15px; }
    .example-sentence { padding: 8px 0; border-bottom: 1px solid #edf2f7; color: #4a5568; }
    .example-sentence:last-child { border-bottom: none; }
    
    .irregular-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .irregular-table th, .irregular-table td { padding: 10px; text-align: center; border-bottom: 2px solid #edf2f7; }
    .irregular-table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    
    .verb-menu { text-align: center; }
    .verb-title { font-size: 1.8rem; font-weight: 800; color: white; margin-bottom: 10px; }
    .verb-subtitle { color: rgba(255,255,255,0.9); margin-bottom: 25px; }
    .verb-stats { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
    .verb-stats span { background: rgba(255,255,255,0.2); padding: 10px 18px; border-radius: 20px; color: white; font-weight: 600; }
    .verb-mode-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; max-width: 350px; margin: 0 auto; }
    .verb-mode-btn {
      background: white; border: none; border-radius: 15px; padding: 20px 12px;
      cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 6px;
    }
    .verb-mode-btn:hover { transform: translateY(-5px); }
    .verb-mode-btn .mode-icon { font-size: 2rem; }
    .verb-mode-btn .mode-name { font-size: 1.1rem; font-weight: 700; color: #2d3748; }
    .verb-mode-btn .mode-desc { font-size: 0.8rem; color: #718096; }
    .verb-mode-btn.flashcard { border-bottom: 4px solid #667eea; }
    .verb-mode-btn.match { border-bottom: 4px solid #f093fb; }
    .verb-mode-btn.fill { border-bottom: 4px solid #f6d365; }
    .verb-mode-btn.test { border-bottom: 4px solid #84fab0; }
    
    .flashcard-mode { max-width: 450px; margin: 0 auto; }
    .flashcard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .flashcard-progress { background: rgba(255,255,255,0.9); padding: 10px 18px; border-radius: 20px; font-weight: 700; color: #4a5568; }
    .flashcard { perspective: 1000px; cursor: pointer; margin-bottom: 25px; }
    .flashcard-inner { position: relative; width: 100%; height: 250px; transition: transform 0.6s; transform-style: preserve-3d; }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
    .flashcard-front, .flashcard-back {
      position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
      border-radius: 20px; display: flex; flex-direction: column;
      align-items: center; justify-content: center; padding: 25px;
    }
    .flashcard-front { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .flashcard-back { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #2d3748; transform: rotateY(180deg); }
    .flashcard-label { font-size: 0.95rem; font-weight: 600; opacity: 0.8; margin-bottom: 10px; }
    .flashcard-word { font-size: 3rem; font-weight: 800; margin-bottom: 15px; }
    .flashcard-hint { font-size: 0.85rem; opacity: 0.7; }
    .flashcard-pair { font-size: 1.1rem; font-weight: 600; margin-top: 10px; padding: 10px 18px; background: rgba(255,255,255,0.5); border-radius: 12px; }
    .flashcard-buttons { display: flex; gap: 12px; justify-content: center; }
    .flashcard-btn { padding: 12px 22px; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; font-family: 'Nunito', sans-serif; }
    .flashcard-btn.prev, .flashcard-btn.next { background: white; color: #4a5568; }
    .flashcard-btn.shuffle { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #5a3e2b; }
    .flashcard-btn:hover { transform: scale(1.05); }
    
    .match-mode { max-width: 550px; margin: 0 auto; }
    .match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .match-score { background: rgba(255,255,255,0.9); padding: 10px 18px; border-radius: 20px; font-weight: 700; color: #4a5568; }
    .match-title { text-align: center; color: white; font-size: 1.2rem; margin-bottom: 20px; }
    .match-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
    .match-card {
      padding: 15px 10px; border: none; border-radius: 12px; font-size: 1.1rem;
      font-weight: 700; cursor: pointer; font-family: 'Nunito', sans-serif;
    }
    .match-card.base { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .match-card.past { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #5a3e2b; }
    .match-card.selected { transform: scale(1.1); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
    .match-card.matched { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #276749; opacity: 0.7; }
    .match-card:hover:not(.matched) { transform: scale(1.05); }
    .match-complete { text-align: center; background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px; }
    .match-complete p { font-size: 1.3rem; font-weight: 700; color: #2d3748; margin-bottom: 15px; }
    
    .verb-fill-mode { max-width: 450px; margin: 0 auto; }
    .verb-fill-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
    .verb-fill-progress, .verb-fill-score { background: rgba(255,255,255,0.9); padding: 10px 18px; border-radius: 20px; font-weight: 700; color: #4a5568; }
    .verb-fill-card { background: rgba(255,255,255,0.98); border-radius: 20px; padding: 30px; text-align: center; }
    .verb-fill-card h3 { font-size: 1.2rem; color: #4a5568; margin-bottom: 15px; }
    .verb-fill-word { font-size: 3rem; font-weight: 800; color: #667eea; margin-bottom: 25px; }
    .verb-fill-input {
      width: 100%; max-width: 280px; padding: 16px 20px; font-size: 1.4rem;
      text-align: center; border: 3px solid #e2e8f0; border-radius: 15px;
      font-family: 'Nunito', sans-serif; font-weight: 600; margin-bottom: 15px;
    }
    .verb-fill-input:focus { outline: none; border-color: #667eea; }
    .verb-fill-result { margin-top: 20px; padding: 20px; border-radius: 12px; }
    .verb-fill-result.correct { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); }
    .verb-fill-result.wrong { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
    .verb-fill-result p { font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; color: #2d3748; }
    
    .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; }
    .confetti { position: absolute; width: 12px; height: 12px; animation: confettiFall 3s linear forwards; }
    @keyframes confettiFall {
      0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    @media (max-width: 600px) {
      .app-title { font-size: 2rem; }
      .question-text { font-size: 1.2rem; }
      .sort-containers { grid-template-columns: 1fr; }
      .tf-buttons { grid-template-columns: 1fr; }
      .match-grid { grid-template-columns: repeat(3, 1fr); }
      .verb-fill-word { font-size: 2.5rem; }
      .flashcard-word { font-size: 2.5rem; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="floating-shapes">
      <span class="shape">ğŸ“š</span><span class="shape">âœ¨</span>
      <span class="shape">ğŸŒŸ</span><span class="shape">ğŸ¯</span><span class="shape">ğŸ†</span>
    </div>
    
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>
    <div id="confettiContainer" class="confetti-container"></div>
    
    <div class="content">
      <div id="homeScreen" class="screen active">
        <div class="home-screen">
          <h1 class="app-title">ğŸŒˆ English Tenses</h1>
          <p class="app-subtitle">Há»c phÃ¢n biá»‡t thÃ¬ Hiá»‡n táº¡i & QuÃ¡ khá»©</p>
          <div class="mascot">ğŸ¦‰</div>
          <div class="menu-buttons">
            <button class="menu-btn play" onclick="initGame()">ğŸ® ChÆ¡i ngay!</button>
            <button class="menu-btn verbs" onclick="showVerbMenu()">ğŸ”„ Há»c Ä‘á»™ng tá»« BQT</button>
            <button class="menu-btn learn" onclick="showLesson()">ğŸ“– Há»c bÃ i</button>
          </div>
        </div>
      </div>
      
      <div id="gameScreen" class="screen"></div>
      <div id="resultScreen" class="screen"></div>
      <div id="lessonScreen" class="screen"></div>
      <div id="verbScreen" class="screen"></div>
    </div>
  </div>

<script>
// ========== DATA ==========
var QUESTIONS = {
  multiple: [
    // === EVERY DAY / EVERY MORNING / EVERY NIGHT ===
    { question: 'I ___ to school every day.', options: ['go', 'went', 'going'], correct: 0, explanation: '"Every day" = má»—i ngÃ y â†’ hiá»‡n táº¡i "go"' },
    { question: 'My cat ___ milk every morning.', options: ['drinks', 'drank', 'drinking'], correct: 0, explanation: '"Every morning" â†’ hiá»‡n táº¡i "drinks"' },
    { question: 'He ___ his homework every day.', options: ['did', 'does', 'doing'], correct: 1, explanation: '"Every day" â†’ hiá»‡n táº¡i "does"' },
    { question: 'Mom ___ dinner every evening.', options: ['cooked', 'cooks', 'cooking'], correct: 1, explanation: '"Every evening" â†’ hiá»‡n táº¡i "cooks"' },
    { question: 'She ___ her teeth every night.', options: ['brush', 'brushes', 'brushed'], correct: 1, explanation: '"Every night" â†’ hiá»‡n táº¡i "brushes"' },
    { question: 'Dad ___ to work every morning.', options: ['drive', 'drives', 'drove'], correct: 1, explanation: '"Every morning" â†’ hiá»‡n táº¡i "drives"' },
    { question: 'The baby ___ a lot every day.', options: ['cry', 'cries', 'cried'], correct: 1, explanation: '"Every day" â†’ hiá»‡n táº¡i "cries"' },
    { question: 'My brother ___ video games every weekend.', options: ['plays', 'played', 'play'], correct: 0, explanation: '"Every weekend" â†’ hiá»‡n táº¡i "plays"' },
    { question: 'Birds ___ in the morning.', options: ['sing', 'sings', 'sang'], correct: 1, explanation: 'ThÃ³i quen â†’ hiá»‡n táº¡i "sings"' },
    { question: 'The dog ___ loudly every night.', options: ['bark', 'barks', 'barked'], correct: 1, explanation: '"Every night" â†’ hiá»‡n táº¡i "barks"' },
    
    // === YESTERDAY / LAST NIGHT / LAST WEEK ===
    { question: 'She ___ a book yesterday.', options: ['reads', 'read', 'reading'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»© "read"' },
    { question: 'They ___ football last Sunday.', options: ['play', 'played', 'plays'], correct: 1, explanation: '"Last Sunday" â†’ quÃ¡ khá»© "played"' },
    { question: 'We ___ a movie last night.', options: ['watch', 'watched', 'watches'], correct: 1, explanation: '"Last night" â†’ quÃ¡ khá»© "watched"' },
    { question: 'I ___ my grandma last weekend.', options: ['visit', 'visited', 'visits'], correct: 1, explanation: '"Last weekend" â†’ quÃ¡ khá»© "visited"' },
    { question: 'We ___ to the zoo last month.', options: ['go', 'went', 'goes'], correct: 1, explanation: '"Last month" â†’ quÃ¡ khá»© "went"' },
    { question: 'She ___ a cake yesterday.', options: ['makes', 'make', 'made'], correct: 2, explanation: '"Yesterday" â†’ quÃ¡ khá»© "made"' },
    { question: 'Tom ___ his bike last week.', options: ['rides', 'ride', 'rode'], correct: 2, explanation: '"Last week" â†’ quÃ¡ khá»© "rode"' },
    { question: 'I ___ a new toy yesterday.', options: ['buy', 'bought', 'buys'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»© "bought"' },
    { question: 'They ___ to music last night.', options: ['listen', 'listened', 'listens'], correct: 1, explanation: '"Last night" â†’ quÃ¡ khá»© "listened"' },
    { question: 'Dad ___ the car yesterday.', options: ['washes', 'wash', 'washed'], correct: 2, explanation: '"Yesterday" â†’ quÃ¡ khá»© "washed"' },
    { question: 'My sister ___ a letter last Monday.', options: ['writes', 'wrote', 'write'], correct: 1, explanation: '"Last Monday" â†’ quÃ¡ khá»© "wrote"' },
    { question: 'The children ___ in the pool last summer.', options: ['swim', 'swam', 'swims'], correct: 1, explanation: '"Last summer" â†’ quÃ¡ khá»© "swam"' },
    
    // === ALWAYS / USUALLY / OFTEN ===
    { question: 'Birds ___ in the sky.', options: ['fly', 'flew', 'flying'], correct: 0, explanation: 'Sá»± tháº­t â†’ hiá»‡n táº¡i "fly"' },
    { question: 'I always ___ breakfast at 7 AM.', options: ['eat', 'ate', 'eats'], correct: 0, explanation: '"Always" â†’ hiá»‡n táº¡i "eat"' },
    { question: 'She usually ___ to bed early.', options: ['go', 'goes', 'went'], correct: 1, explanation: '"Usually" â†’ hiá»‡n táº¡i "goes"' },
    { question: 'They often ___ in the park.', options: ['run', 'runs', 'ran'], correct: 0, explanation: '"Often" â†’ hiá»‡n táº¡i "run"' },
    { question: 'He sometimes ___ his room.', options: ['clean', 'cleans', 'cleaned'], correct: 1, explanation: '"Sometimes" â†’ hiá»‡n táº¡i "cleans"' },
    { question: 'The sun ___ in the East.', options: ['rise', 'rises', 'rose'], correct: 1, explanation: 'Sá»± tháº­t â†’ hiá»‡n táº¡i "rises"' },
    { question: 'Water ___ at 100 degrees.', options: ['boil', 'boils', 'boiled'], correct: 1, explanation: 'Sá»± tháº­t khoa há»c â†’ hiá»‡n táº¡i "boils"' },
    { question: 'Dogs ___ bones.', options: ['like', 'likes', 'liked'], correct: 0, explanation: 'Sá»± tháº­t â†’ hiá»‡n táº¡i "like"' },
    
    // === AGO / THIS MORNING ===
    { question: 'I ___ a sandwich two hours ago.', options: ['eat', 'ate', 'eats'], correct: 1, explanation: '"Ago" â†’ quÃ¡ khá»© "ate"' },
    { question: 'She ___ her keys three days ago.', options: ['loses', 'lose', 'lost'], correct: 2, explanation: '"Ago" â†’ quÃ¡ khá»© "lost"' },
    { question: 'We ___ to London in 2022.', options: ['travel', 'traveled', 'travels'], correct: 1, explanation: '"In 2022" â†’ quÃ¡ khá»© "traveled"' },
    { question: 'Tom ___ his first word a year ago.', options: ['say', 'says', 'said'], correct: 2, explanation: '"A year ago" â†’ quÃ¡ khá»© "said"' },
    { question: 'I ___ breakfast this morning.', options: ['have', 'has', 'had'], correct: 2, explanation: '"This morning" (Ä‘Ã£ qua) â†’ quÃ¡ khá»© "had"' },
    { question: 'The movie ___ at 8 PM yesterday.', options: ['start', 'starts', 'started'], correct: 2, explanation: '"Yesterday" â†’ quÃ¡ khá»© "started"' },
    
    // === Äá»˜NG Tá»ª Báº¤T QUY Táº®C ===
    { question: 'I ___ a strange dream last night.', options: ['have', 'has', 'had'], correct: 2, explanation: '"Last night" â†’ quÃ¡ khá»© "had"' },
    { question: 'She ___ me a gift yesterday.', options: ['give', 'gives', 'gave'], correct: 2, explanation: '"Yesterday" â†’ quÃ¡ khá»© "gave"' },
    { question: 'We ___ a bird in the garden this morning.', options: ['see', 'sees', 'saw'], correct: 2, explanation: '"This morning" â†’ quÃ¡ khá»© "saw"' },
    { question: 'He ___ home late last night.', options: ['come', 'comes', 'came'], correct: 2, explanation: '"Last night" â†’ quÃ¡ khá»© "came"' },
    { question: 'I ___ my phone yesterday.', options: ['find', 'found', 'finds'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»© "found"' },
    { question: 'Mom ___ us a story yesterday.', options: ['tell', 'told', 'tells'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»© "told"' },
    { question: 'I ___ a glass of water an hour ago.', options: ['drink', 'drank', 'drinks'], correct: 1, explanation: '"An hour ago" â†’ quÃ¡ khá»© "drank"' },
    { question: 'She ___ a beautiful song last night.', options: ['sing', 'sang', 'sings'], correct: 1, explanation: '"Last night" â†’ quÃ¡ khá»© "sang"' },
    { question: 'Dad ___ the newspaper every morning.', options: ['read', 'reads', 'reading'], correct: 1, explanation: '"Every morning" â†’ hiá»‡n táº¡i "reads"' },
    { question: 'The teacher ___ us English last year.', options: ['teach', 'taught', 'teaches'], correct: 1, explanation: '"Last year" â†’ quÃ¡ khá»© "taught"' },
    { question: 'I ___ a lot about history yesterday.', options: ['learn', 'learned', 'learns'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»© "learned"' },
    { question: 'She ___ her bag at school last week.', options: ['leave', 'left', 'leaves'], correct: 1, explanation: '"Last week" â†’ quÃ¡ khá»© "left"' },
    
    // === CÃ‚U PHá»¦ Äá»ŠNH - HIá»†N Táº I ===
    { question: 'I ___ like spiders.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 0, explanation: 'I + don\'t + Ä‘á»™ng tá»« gá»‘c' },
    { question: 'She ___ eat vegetables.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 1, explanation: 'She + doesn\'t + Ä‘á»™ng tá»« gá»‘c' },
    { question: 'He ___ go to school on Sunday.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 1, explanation: 'He + doesn\'t + Ä‘á»™ng tá»« gá»‘c' },
    { question: 'They ___ like homework.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 0, explanation: 'They + don\'t + Ä‘á»™ng tá»« gá»‘c' },
    { question: 'My cat ___ like water.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 1, explanation: 'My cat (it) + doesn\'t' },
    { question: 'We ___ watch TV every day.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 0, explanation: 'We + don\'t + Ä‘á»™ng tá»« gá»‘c' },
    { question: 'The baby ___ sleep well.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 1, explanation: 'The baby (it) + doesn\'t' },
    { question: 'I ___ have a pet.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 0, explanation: 'I + don\'t + Ä‘á»™ng tá»« gá»‘c' },
    { question: 'She doesn\'t ___ meat.', options: ['eat', 'eats', 'ate'], correct: 0, explanation: 'Sau doesn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'He doesn\'t ___ English.', options: ['speaks', 'speak', 'spoke'], correct: 1, explanation: 'Sau doesn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'They don\'t ___ coffee.', options: ['drinks', 'drink', 'drank'], correct: 1, explanation: 'Sau don\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'My mom doesn\'t ___ fast food.', options: ['like', 'likes', 'liked'], correct: 0, explanation: 'Sau doesn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    
    // === CÃ‚U PHá»¦ Äá»ŠNH - QUÃ KHá»¨ ===
    { question: 'I ___ go to school yesterday.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 2, explanation: '"Yesterday" â†’ quÃ¡ khá»© â†’ didn\'t' },
    { question: 'She ___ watch TV last night.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 2, explanation: '"Last night" â†’ quÃ¡ khá»© â†’ didn\'t' },
    { question: 'They ___ play football last Sunday.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 2, explanation: '"Last Sunday" â†’ quÃ¡ khá»© â†’ didn\'t' },
    { question: 'He ___ eat breakfast this morning.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 2, explanation: '"This morning" Ä‘Ã£ qua â†’ didn\'t' },
    { question: 'We ___ see the movie last week.', options: ['don\'t', 'doesn\'t', 'didn\'t'], correct: 2, explanation: '"Last week" â†’ quÃ¡ khá»© â†’ didn\'t' },
    { question: 'I didn\'t ___ to the party yesterday.', options: ['go', 'goes', 'went'], correct: 0, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'She didn\'t ___ her homework last night.', options: ['do', 'does', 'did'], correct: 0, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'They didn\'t ___ the test yesterday.', options: ['took', 'take', 'takes'], correct: 1, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'He didn\'t ___ me a gift.', options: ['give', 'gives', 'gave'], correct: 0, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { question: 'We didn\'t ___ to music last night.', options: ['listen', 'listens', 'listened'], correct: 0, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' }
  ],
  fill: [
    // === QUÃ KHá»¨ - Äá»˜NG Tá»ª CÃ“ QUY Táº®C ===
    { sentence: 'They ___ (play) games yesterday.', answer: 'played', hint: '"Yesterday"! ThÃªm -ed' },
    { sentence: 'She ___ (watch) TV last night.', answer: 'watched', hint: '"Last night"! ThÃªm -ed' },
    { sentence: 'I ___ (walk) to school yesterday.', answer: 'walked', hint: '"Yesterday"! ThÃªm -ed' },
    { sentence: 'Mom ___ (cook) dinner last evening.', answer: 'cooked', hint: '"Last evening"! ThÃªm -ed' },
    { sentence: 'We ___ (visit) grandma last weekend.', answer: 'visited', hint: '"Last weekend"! ThÃªm -ed' },
    { sentence: 'He ___ (help) his mom yesterday.', answer: 'helped', hint: '"Yesterday"! ThÃªm -ed' },
    { sentence: 'The baby ___ (cry) a lot yesterday.', answer: 'cried', hint: '"Yesterday"! cry â†’ cried' },
    { sentence: 'She ___ (study) English last year.', answer: 'studied', hint: '"Last year"! study â†’ studied' },
    { sentence: 'They ___ (dance) at the party last night.', answer: 'danced', hint: '"Last night"! ThÃªm -d' },
    { sentence: 'I ___ (clean) my room yesterday.', answer: 'cleaned', hint: '"Yesterday"! ThÃªm -ed' },
    { sentence: 'He ___ (finish) homework last night.', answer: 'finished', hint: '"Last night"! ThÃªm -ed' },
    { sentence: 'We ___ (play) tennis last Sunday.', answer: 'played', hint: '"Last Sunday"! ThÃªm -ed' },
    
    // === QUÃ KHá»¨ - Äá»˜NG Tá»ª Báº¤T QUY Táº®C ===
    { sentence: 'I ___ (eat) breakfast this morning.', answer: 'ate', hint: '"This morning" Ä‘Ã£ qua! eat â†’ ate' },
    { sentence: 'We ___ (see) a rainbow last week.', answer: 'saw', hint: '"Last week"! see â†’ saw' },
    { sentence: 'She ___ (go) to the park yesterday.', answer: 'went', hint: '"Yesterday"! go â†’ went' },
    { sentence: 'I ___ (have) a good dream last night.', answer: 'had', hint: '"Last night"! have â†’ had' },
    { sentence: 'He ___ (come) home late yesterday.', answer: 'came', hint: '"Yesterday"! come â†’ came' },
    { sentence: 'Mom ___ (make) a cake last Sunday.', answer: 'made', hint: '"Last Sunday"! make â†’ made' },
    { sentence: 'We ___ (take) many photos last holiday.', answer: 'took', hint: '"Last holiday"! take â†’ took' },
    { sentence: 'I ___ (get) a new bike last month.', answer: 'got', hint: '"Last month"! get â†’ got' },
    { sentence: 'The children ___ (run) in the park yesterday.', answer: 'ran', hint: '"Yesterday"! run â†’ ran' },
    { sentence: 'She ___ (swim) in the sea last summer.', answer: 'swam', hint: '"Last summer"! swim â†’ swam' },
    { sentence: 'Dad ___ (drive) to work yesterday.', answer: 'drove', hint: '"Yesterday"! drive â†’ drove' },
    { sentence: 'I ___ (write) a letter last week.', answer: 'wrote', hint: '"Last week"! write â†’ wrote' },
    { sentence: 'She ___ (sing) a song at the party.', answer: 'sang', hint: 'Party Ä‘Ã£ káº¿t thÃºc! sing â†’ sang' },
    { sentence: 'We ___ (drink) juice this morning.', answer: 'drank', hint: '"This morning" Ä‘Ã£ qua! drink â†’ drank' },
    { sentence: 'He ___ (give) me a present yesterday.', answer: 'gave', hint: '"Yesterday"! give â†’ gave' },
    { sentence: 'I ___ (find) my keys last night.', answer: 'found', hint: '"Last night"! find â†’ found' },
    { sentence: 'She ___ (tell) me a secret yesterday.', answer: 'told', hint: '"Yesterday"! tell â†’ told' },
    { sentence: 'They ___ (buy) a new car last month.', answer: 'bought', hint: '"Last month"! buy â†’ bought' },
    
    // === HIá»†N Táº I ÄÆ N ===
    { sentence: 'She ___ (go) to school every day.', answer: 'goes', hint: '"Every day"! she â†’ goes' },
    { sentence: 'My dog ___ (like) bones.', answer: 'likes', hint: 'Sá»± tháº­t! ThÃªm -s' },
    { sentence: 'He ___ (drink) water every day.', answer: 'drinks', hint: '"Every day"! ThÃªm -s' },
    { sentence: 'The sun ___ (rise) in the East.', answer: 'rises', hint: 'Sá»± tháº­t! ThÃªm -s' },
    { sentence: 'She ___ (brush) her teeth every night.', answer: 'brushes', hint: '"Every night"! brush â†’ brushes' },
    { sentence: 'My mom ___ (cook) dinner every day.', answer: 'cooks', hint: '"Every day"! ThÃªm -s' },
    { sentence: 'He ___ (watch) TV every evening.', answer: 'watches', hint: '"Every evening"! watch â†’ watches' },
    { sentence: 'She ___ (study) English every day.', answer: 'studies', hint: '"Every day"! study â†’ studies' },
    { sentence: 'The baby ___ (cry) every night.', answer: 'cries', hint: '"Every night"! cry â†’ cries' },
    { sentence: 'He always ___ (do) his homework.', answer: 'does', hint: '"Always"! he â†’ does' },
    { sentence: 'My sister ___ (read) books every weekend.', answer: 'reads', hint: '"Every weekend"! ThÃªm -s' },
    { sentence: 'The cat ___ (sleep) all day.', answer: 'sleeps', hint: 'ThÃ³i quen! ThÃªm -s' },
    
    // === CÃ‚U PHá»¦ Äá»ŠNH ===
    { sentence: 'I ___ (not like) spiders.', answer: 'don\'t like', hint: 'I + don\'t + Ä‘á»™ng tá»« gá»‘c' },
    { sentence: 'She ___ (not eat) meat.', answer: 'doesn\'t eat', hint: 'She + doesn\'t + Ä‘á»™ng tá»« gá»‘c' },
    { sentence: 'He ___ (not play) football.', answer: 'doesn\'t play', hint: 'He + doesn\'t + Ä‘á»™ng tá»« gá»‘c' },
    { sentence: 'They ___ (not watch) TV every day.', answer: 'don\'t watch', hint: 'They + don\'t + Ä‘á»™ng tá»« gá»‘c' },
    { sentence: 'My dog ___ (not like) cats.', answer: 'doesn\'t like', hint: 'My dog (it) + doesn\'t' },
    { sentence: 'I ___ (not go) to school yesterday.', answer: 'didn\'t go', hint: '"Yesterday" â†’ didn\'t + Ä‘á»™ng tá»« gá»‘c!' },
    { sentence: 'She ___ (not watch) TV last night.', answer: 'didn\'t watch', hint: '"Last night" â†’ didn\'t + Ä‘á»™ng tá»« gá»‘c!' },
    { sentence: 'They ___ (not play) games yesterday.', answer: 'didn\'t play', hint: '"Yesterday" â†’ didn\'t + Ä‘á»™ng tá»« gá»‘c!' },
    { sentence: 'He ___ (not eat) breakfast this morning.', answer: 'didn\'t eat', hint: '"This morning" â†’ didn\'t + Ä‘á»™ng tá»« gá»‘c!' },
    { sentence: 'We ___ (not see) the movie last week.', answer: 'didn\'t see', hint: '"Last week" â†’ didn\'t + Ä‘á»™ng tá»« gá»‘c!' }
  ],
  truefalse: [
    // === Vá»€ Tá»ª NHáº¬N BIáº¾T THÃŒ ===
    { statement: '"Yesterday" dÃ¹ng vá»›i thÃ¬ quÃ¡ khá»©', correct: true, explanation: 'ÄÃºng! "Yesterday" = hÃ´m qua â†’ quÃ¡ khá»©' },
    { statement: '"Every day" dÃ¹ng vá»›i thÃ¬ quÃ¡ khá»©', correct: false, explanation: 'Sai! "Every day" = má»—i ngÃ y â†’ hiá»‡n táº¡i' },
    { statement: '"Last night" dÃ¹ng vá»›i thÃ¬ hiá»‡n táº¡i', correct: false, explanation: 'Sai! "Last night" = tá»‘i qua â†’ quÃ¡ khá»©' },
    { statement: '"Always" dÃ¹ng vá»›i thÃ¬ hiá»‡n táº¡i', correct: true, explanation: 'ÄÃºng! "Always" = luÃ´n luÃ´n â†’ hiá»‡n táº¡i' },
    { statement: '"Ago" lÃ  tá»« nháº­n biáº¿t thÃ¬ quÃ¡ khá»©', correct: true, explanation: 'ÄÃºng! "Ago" = trÆ°á»›c Ä‘Ã¢y â†’ quÃ¡ khá»©' },
    { statement: '"Usually" dÃ¹ng vá»›i thÃ¬ quÃ¡ khá»©', correct: false, explanation: 'Sai! "Usually" = thÆ°á»ng â†’ hiá»‡n táº¡i' },
    { statement: '"Last week" dÃ¹ng vá»›i thÃ¬ quÃ¡ khá»©', correct: true, explanation: 'ÄÃºng! "Last week" = tuáº§n trÆ°á»›c â†’ quÃ¡ khá»©' },
    { statement: '"Every morning" dÃ¹ng vá»›i thÃ¬ hiá»‡n táº¡i', correct: true, explanation: 'ÄÃºng! "Every morning" = má»—i sÃ¡ng â†’ hiá»‡n táº¡i' },
    { statement: '"Sometimes" lÃ  tá»« nháº­n biáº¿t thÃ¬ quÃ¡ khá»©', correct: false, explanation: 'Sai! "Sometimes" = Ä‘Ã´i khi â†’ hiá»‡n táº¡i' },
    { statement: '"In 2020" dÃ¹ng vá»›i thÃ¬ quÃ¡ khá»©', correct: true, explanation: 'ÄÃºng! NÄƒm trong quÃ¡ khá»© â†’ quÃ¡ khá»©' },
    { statement: '"Often" dÃ¹ng vá»›i thÃ¬ hiá»‡n táº¡i', correct: true, explanation: 'ÄÃºng! "Often" = thÆ°á»ng xuyÃªn â†’ hiá»‡n táº¡i' },
    { statement: '"Last summer" dÃ¹ng vá»›i thÃ¬ hiá»‡n táº¡i', correct: false, explanation: 'Sai! "Last summer" = mÃ¹a hÃ¨ trÆ°á»›c â†’ quÃ¡ khá»©' },
    
    // === Vá»€ CÃCH CHIA Äá»˜NG Tá»ª ===
    { statement: '"Played" lÃ  dáº¡ng quÃ¡ khá»© cá»§a "play"', correct: true, explanation: 'ÄÃºng! play + ed = played' },
    { statement: '"Go - went" lÃ  Ä‘á»™ng tá»« báº¥t quy táº¯c', correct: true, explanation: 'ÄÃºng! Go â†’ went (khÃ´ng thÃªm -ed)' },
    { statement: 'ThÃªm -ed vÃ o "eat" thÃ nh "eated"', correct: false, explanation: 'Sai! "Eat" báº¥t quy táº¯c â†’ "ate"' },
    { statement: '"Watched" lÃ  dáº¡ng quÃ¡ khá»© cá»§a "watch"', correct: true, explanation: 'ÄÃºng! watch + ed = watched' },
    { statement: '"See - saw" lÃ  Ä‘á»™ng tá»« báº¥t quy táº¯c', correct: true, explanation: 'ÄÃºng! See â†’ saw' },
    { statement: 'QuÃ¡ khá»© cá»§a "have" lÃ  "haved"', correct: false, explanation: 'Sai! Have báº¥t quy táº¯c â†’ "had"' },
    { statement: 'QuÃ¡ khá»© cá»§a "make" lÃ  "made"', correct: true, explanation: 'ÄÃºng! Make â†’ made' },
    { statement: 'QuÃ¡ khá»© cá»§a "come" lÃ  "comed"', correct: false, explanation: 'Sai! Come báº¥t quy táº¯c â†’ came' },
    { statement: '"Studied" lÃ  dáº¡ng quÃ¡ khá»© cá»§a "study"', correct: true, explanation: 'ÄÃºng! study â†’ studied (y â†’ ied)' },
    { statement: 'QuÃ¡ khá»© cá»§a "swim" lÃ  "swimmed"', correct: false, explanation: 'Sai! Swim báº¥t quy táº¯c â†’ swam' },
    { statement: 'QuÃ¡ khá»© cá»§a "run" lÃ  "ran"', correct: true, explanation: 'ÄÃºng! Run â†’ ran' },
    { statement: 'QuÃ¡ khá»© cá»§a "take" lÃ  "taked"', correct: false, explanation: 'Sai! Take báº¥t quy táº¯c â†’ took' },
    
    // === Vá»€ QUY Táº®C THÃŒ ===
    { statement: 'ThÃ¬ hiá»‡n táº¡i dÃ¹ng Ä‘á»ƒ nÃ³i vá» thÃ³i quen', correct: true, explanation: 'ÄÃºng! ThÃ³i quen â†’ hiá»‡n táº¡i' },
    { statement: 'ThÃ¬ quÃ¡ khá»© dÃ¹ng Ä‘á»ƒ nÃ³i vá» viá»‡c xáº£y ra hÃ´m qua', correct: true, explanation: 'ÄÃºng! Viá»‡c Ä‘Ã£ xáº£y ra â†’ quÃ¡ khá»©' },
    { statement: 'Sá»± tháº­t khoa há»c dÃ¹ng thÃ¬ quÃ¡ khá»©', correct: false, explanation: 'Sai! Sá»± tháº­t luÃ´n Ä‘Ãºng â†’ hiá»‡n táº¡i' },
    { statement: 'Vá»›i "she/he", Ä‘á»™ng tá»« hiá»‡n táº¡i thÃªm -s hoáº·c -es', correct: true, explanation: 'ÄÃºng! She goes, He watches' },
    { statement: 'Äá»™ng tá»« quÃ¡ khá»© cÃ³ quy táº¯c thÃªm -ed', correct: true, explanation: 'ÄÃºng! play â†’ played' },
    
    // === Vá»€ CÃ‚U PHá»¦ Äá»ŠNH ===
    { statement: 'CÃ¢u "I doesn\'t like fish" lÃ  Ä‘Ãºng', correct: false, explanation: 'Sai! I + don\'t (khÃ´ng pháº£i doesn\'t)' },
    { statement: 'CÃ¢u "She don\'t eat meat" lÃ  Ä‘Ãºng', correct: false, explanation: 'Sai! She + doesn\'t (khÃ´ng pháº£i don\'t)' },
    { statement: 'Sau "doesn\'t", Ä‘á»™ng tá»« giá»¯ nguyÃªn dáº¡ng gá»‘c', correct: true, explanation: 'ÄÃºng! She doesn\'t go (khÃ´ng pháº£i goes)' },
    { statement: 'Sau "didn\'t", Ä‘á»™ng tá»« vá» dáº¡ng gá»‘c', correct: true, explanation: 'ÄÃºng! I didn\'t go (khÃ´ng pháº£i went)' },
    { statement: 'CÃ¢u "He didn\'t went to school" lÃ  Ä‘Ãºng', correct: false, explanation: 'Sai! Sau didn\'t â†’ go (dáº¡ng gá»‘c)' },
    { statement: 'CÃ¢u "She doesn\'t likes cats" lÃ  Ä‘Ãºng', correct: false, explanation: 'Sai! Sau doesn\'t â†’ like (dáº¡ng gá»‘c)' },
    { statement: '"Don\'t" dÃ¹ng vá»›i I, You, We, They', correct: true, explanation: 'ÄÃºng! I don\'t, You don\'t, We don\'t, They don\'t' },
    { statement: '"Doesn\'t" dÃ¹ng vá»›i He, She, It', correct: true, explanation: 'ÄÃºng! He doesn\'t, She doesn\'t, It doesn\'t' },
    { statement: '"Didn\'t" dÃ¹ng cho táº¥t cáº£ chá»§ ngá»¯ á»Ÿ quÃ¡ khá»©', correct: true, explanation: 'ÄÃºng! I/You/He/She/We/They didn\'t' }
  ],
  picture: [
    // === THIÃŠN NHIÃŠN & Sá»° THáº¬T ===
    { image: 'ğŸŒ…', question: 'Chá»n cÃ¢u Ä‘Ãºng:', options: ['The sun rises every day.', 'The sun rised yesterday.'], correct: 0, explanation: 'Sá»± tháº­t â†’ hiá»‡n táº¡i "rises"!' },
    { image: 'ğŸŒ™', question: 'Máº·t trÄƒng xuáº¥t hiá»‡n má»—i Ä‘Ãªm:', options: ['The moon appears every night.', 'The moon appeared every night.'], correct: 0, explanation: '"Má»—i Ä‘Ãªm" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸŒ§ï¸', question: 'HÃ´m qua trá»i mÆ°a:', options: ['It rains yesterday.', 'It rained yesterday.'], correct: 1, explanation: '"HÃ´m qua" â†’ quÃ¡ khá»©!' },
    { image: 'â­', question: 'Sao sÃ¡ng má»—i Ä‘Ãªm:', options: ['Stars shine every night.', 'Stars shined every night.'], correct: 0, explanation: '"Má»—i Ä‘Ãªm" â†’ hiá»‡n táº¡i!' },
    
    // === SINH HOáº T Háº°NG NGÃ€Y ===
    { image: 'ğŸ“š', question: 'Lisa Ä‘á»c sÃ¡ch má»—i tá»‘i:', options: ['Lisa reads every night.', 'Lisa read every night.'], correct: 0, explanation: '"Má»—i tá»‘i" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ¦·', question: 'Tom Ä‘Ã¡nh rÄƒng má»—i sÃ¡ng:', options: ['Tom brushes teeth every morning.', 'Tom brushed teeth every morning.'], correct: 0, explanation: '"Má»—i sÃ¡ng" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ›ï¸', question: 'BÃ© ngá»§ lÃºc 9 giá» má»—i tá»‘i:', options: ['The baby sleeps at 9 PM.', 'The baby slept at 9 PM.'], correct: 0, explanation: 'ThÃ³i quen â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ³', question: 'Máº¹ náº¥u bá»¯a sÃ¡ng má»—i ngÃ y:', options: ['Mom cooks breakfast every day.', 'Mom cooked breakfast every day.'], correct: 0, explanation: '"Má»—i ngÃ y" â†’ hiá»‡n táº¡i!' },
    
    // === Sá»° KIá»†N QUÃ KHá»¨ ===
    { image: 'ğŸ‚', question: 'HÃ´m qua lÃ  sinh nháº­t Tom:', options: ['Tom has a party.', 'Tom had a party.'], correct: 1, explanation: '"HÃ´m qua" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸŠ', question: 'Tuáº§n trÆ°á»›c Tom Ä‘i bÆ¡i:', options: ['Tom swims last week.', 'Tom swam last week.'], correct: 1, explanation: '"Last week" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ', question: 'HÃ´m qua máº¹ táº·ng quÃ :', options: ['Mom gives a gift yesterday.', 'Mom gave a gift yesterday.'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»©!' },
    { image: 'âœˆï¸', question: 'NÄƒm ngoÃ¡i gia Ä‘Ã¬nh Ä‘i du lá»‹ch:', options: ['The family travels last year.', 'The family traveled last year.'], correct: 1, explanation: '"Last year" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ¬', question: 'Tá»‘i qua chÃºng tÃ´i xem phim:', options: ['We watch a movie last night.', 'We watched a movie last night.'], correct: 1, explanation: '"Last night" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ¤', question: 'CÃ´ áº¥y hÃ¡t á»Ÿ buá»•i tiá»‡c hÃ´m qua:', options: ['She sings at the party.', 'She sang at the party.'], correct: 1, explanation: '"HÃ´m qua" â†’ quÃ¡ khá»©!' },
    
    // === THÃ“I QUEN ===
    { image: 'ğŸ', question: 'Mary Äƒn tÃ¡o má»—i ngÃ y:', options: ['Mary eats an apple every day.', 'Mary ate an apple every day.'], correct: 0, explanation: '"Every day" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸšŒ', question: 'Há»c sinh Ä‘i xe buÃ½t má»—i ngÃ y:', options: ['Students take the bus every day.', 'Students took the bus every day.'], correct: 0, explanation: '"Every day" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸƒ', question: 'Bá»‘ cháº¡y bá»™ má»—i sÃ¡ng:', options: ['Dad runs every morning.', 'Dad ran every morning.'], correct: 0, explanation: '"Every morning" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ®', question: 'Anh trai chÆ¡i game má»—i cuá»‘i tuáº§n:', options: ['My brother plays games every weekend.', 'My brother played games every weekend.'], correct: 0, explanation: '"Every weekend" â†’ hiá»‡n táº¡i!' },
    
    // === Äá»˜NG Váº¬T ===
    { image: 'ğŸ•', question: 'Con chÃ³ sá»§a má»—i Ä‘Ãªm:', options: ['The dog barks every night.', 'The dog barked every night.'], correct: 0, explanation: '"Every night" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ±', question: 'HÃ´m qua con mÃ¨o báº¯t chuá»™t:', options: ['The cat catches a mouse yesterday.', 'The cat caught a mouse yesterday.'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ¦', question: 'Chim hÃ³t má»—i sÃ¡ng:', options: ['Birds sing every morning.', 'Birds sang every morning.'], correct: 0, explanation: '"Every morning" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸŸ', question: 'CÃ¡ bÆ¡i trong nÆ°á»›c:', options: ['Fish swim in water.', 'Fish swam in water.'], correct: 0, explanation: 'Sá»± tháº­t â†’ hiá»‡n táº¡i!' },
    
    // === Bá»®A Ä‚N ===
    { image: 'ğŸ•', question: 'Tá»‘i qua chÃºng tÃ´i Äƒn pizza:', options: ['We eat pizza last night.', 'We ate pizza last night.'], correct: 1, explanation: '"Last night" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ¦', question: 'HÃ´m qua bÃ© Äƒn kem:', options: ['The baby eats ice cream yesterday.', 'The baby ate ice cream yesterday.'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ¥›', question: 'Em bÃ© uá»‘ng sá»¯a má»—i ngÃ y:', options: ['The baby drinks milk every day.', 'The baby drank milk every day.'], correct: 0, explanation: '"Every day" â†’ hiá»‡n táº¡i!' },
    
    // === Há»ŒC Táº¬P ===
    { image: 'âœï¸', question: 'Há»c sinh viáº¿t bÃ i má»—i ngÃ y:', options: ['Students write every day.', 'Students wrote every day.'], correct: 0, explanation: '"Every day" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ“', question: 'HÃ´m qua tÃ´i lÃ m bÃ i kiá»ƒm tra:', options: ['I take a test yesterday.', 'I took a test yesterday.'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»©!' },
    { image: 'ğŸ’', question: 'Em bÃ© Ä‘i há»c má»—i ngÃ y:', options: ['The child goes to school every day.', 'The child went to school every day.'], correct: 0, explanation: '"Every day" â†’ hiá»‡n táº¡i!' },
    { image: 'ğŸ“–', question: 'CÃ´ giÃ¡o dáº¡y chÃºng tÃ´i hÃ´m qua:', options: ['The teacher teaches us yesterday.', 'The teacher taught us yesterday.'], correct: 1, explanation: '"Yesterday" â†’ quÃ¡ khá»©!' },
    
    // === CÃ‚U PHá»¦ Äá»ŠNH ===
    { image: 'ğŸ¥¦', question: 'Tom khÃ´ng thÃ­ch rau:', options: ['Tom don\'t like vegetables.', 'Tom doesn\'t like vegetables.'], correct: 1, explanation: 'Tom (he) + doesn\'t!' },
    { image: 'ğŸ•·ï¸', question: 'CÃ´ áº¥y khÃ´ng thÃ­ch nhá»‡n:', options: ['She don\'t like spiders.', 'She doesn\'t like spiders.'], correct: 1, explanation: 'She + doesn\'t!' },
    { image: 'â˜•', question: 'TÃ´i khÃ´ng uá»‘ng cÃ  phÃª:', options: ['I doesn\'t drink coffee.', 'I don\'t drink coffee.'], correct: 1, explanation: 'I + don\'t!' },
    { image: 'ğŸ«', question: 'Anh áº¥y khÃ´ng Ä‘i há»c hÃ´m qua:', options: ['He didn\'t go to school.', 'He didn\'t went to school.'], correct: 0, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C (go)!' },
    { image: 'ğŸ“º', question: 'Há» khÃ´ng xem TV tá»‘i qua:', options: ['They didn\'t watch TV.', 'They didn\'t watched TV.'], correct: 0, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { image: 'ğŸ”', question: 'CÃ´ áº¥y khÃ´ng Äƒn sÃ¡ng hÃ´m qua:', options: ['She didn\'t ate breakfast.', 'She didn\'t eat breakfast.'], correct: 1, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { image: 'âš½', question: 'ChÃºng tÃ´i khÃ´ng chÆ¡i bÃ³ng tuáº§n trÆ°á»›c:', options: ['We didn\'t played football.', 'We didn\'t play football.'], correct: 1, explanation: 'Sau didn\'t â†’ Ä‘á»™ng tá»« Gá»C!' },
    { image: 'ğŸµ', question: 'Anh áº¥y khÃ´ng nghe nháº¡c má»—i ngÃ y:', options: ['He don\'t listen to music.', 'He doesn\'t listen to music.'], correct: 1, explanation: 'He + doesn\'t!' }
  ],
  sort: [
    { instruction: 'PhÃ¢n loáº¡i tá»« thá»i gian!', words: ['yesterday', 'every day', 'last week', 'always', 'ago', 'now'], presentWords: ['every day', 'always', 'now'], pastWords: ['yesterday', 'last week', 'ago'] },
    { instruction: 'PhÃ¢n loáº¡i Ä‘á»™ng tá»«!', words: ['played', 'eat', 'went', 'like', 'watched', 'run'], presentWords: ['eat', 'like', 'run'], pastWords: ['played', 'went', 'watched'] },
    { instruction: 'KÃ©o tá»« vÃ o Ä‘Ãºng thÃ¬!', words: ['usually', 'last year', 'often', 'two days ago', 'sometimes', 'last Monday'], presentWords: ['usually', 'often', 'sometimes'], pastWords: ['last year', 'two days ago', 'last Monday'] },
    { instruction: 'PhÃ¢n loáº¡i tá»« thá»i gian!', words: ['every morning', 'last night', 'every week', 'yesterday', 'last month', 'every evening'], presentWords: ['every morning', 'every week', 'every evening'], pastWords: ['last night', 'yesterday', 'last month'] },
    { instruction: 'Äá»™ng tá»« nÃ o á»Ÿ thÃ¬ nÃ o?', words: ['sang', 'drink', 'ate', 'sleep', 'came', 'walk'], presentWords: ['drink', 'sleep', 'walk'], pastWords: ['sang', 'ate', 'came'] },
    { instruction: 'PhÃ¢n loáº¡i cÃ¡c tá»«!', words: ['last summer', 'every night', 'a week ago', 'always', 'in 2020', 'usually'], presentWords: ['every night', 'always', 'usually'], pastWords: ['last summer', 'a week ago', 'in 2020'] },
    { instruction: 'KÃ©o Ä‘á»™ng tá»« vÃ o Ä‘Ãºng cá»™t!', words: ['made', 'make', 'took', 'take', 'gave', 'give'], presentWords: ['make', 'take', 'give'], pastWords: ['made', 'took', 'gave'] },
    { instruction: 'PhÃ¢n loáº¡i Ä‘á»™ng tá»«!', words: ['wrote', 'write', 'saw', 'see', 'had', 'have'], presentWords: ['write', 'see', 'have'], pastWords: ['wrote', 'saw', 'had'] },
    { instruction: 'Tá»« nÃ o thuá»™c thÃ¬ nÃ o?', words: ['last Friday', 'every Sunday', 'three years ago', 'often', 'yesterday morning', 'sometimes'], presentWords: ['every Sunday', 'often', 'sometimes'], pastWords: ['last Friday', 'three years ago', 'yesterday morning'] },
    { instruction: 'PhÃ¢n loáº¡i Ä‘á»™ng tá»«!', words: ['swam', 'swim', 'ran', 'run', 'drank', 'drink'], presentWords: ['swim', 'run', 'drink'], pastWords: ['swam', 'ran', 'drank'] }
  ]
};

var IRREGULAR_VERBS = [
  {base:'go',past:'went'},{base:'eat',past:'ate'},{base:'see',past:'saw'},{base:'have',past:'had'},
  {base:'come',past:'came'},{base:'make',past:'made'},{base:'take',past:'took'},{base:'get',past:'got'},
  {base:'run',past:'ran'},{base:'swim',past:'swam'},{base:'drink',past:'drank'},{base:'sing',past:'sang'},
  {base:'write',past:'wrote'},{base:'read',past:'read'},{base:'give',past:'gave'},{base:'find',past:'found'},
  {base:'tell',past:'told'},{base:'say',past:'said'},{base:'buy',past:'bought'},{base:'bring',past:'brought'},
  {base:'think',past:'thought'},{base:'catch',past:'caught'},{base:'teach',past:'taught'},{base:'sit',past:'sat'},
  {base:'sleep',past:'slept'},{base:'keep',past:'kept'},{base:'leave',past:'left'},{base:'lose',past:'lost'},
  {base:'drive',past:'drove'},{base:'fly',past:'flew'},{base:'know',past:'knew'},{base:'grow',past:'grew'},
  {base:'begin',past:'began'},{base:'break',past:'broke'},{base:'speak',past:'spoke'},{base:'wear',past:'wore'}
];

var TIME_SIGNALS = {
  present: ['every day','always','usually','sometimes','often','now','every morning'],
  past: ['yesterday','last week','last night','ago','last year','last month']
};

// ========== STATE ==========
var soundEnabled = true;
var gameQuestions = [];
var currentQ = 0;
var score = 0;
var streak = 0;
var sortedPresent = [];
var sortedPast = [];
var remainingWords = [];
var selectedWord = null;
var verbMode = 'menu';
var shuffledVerbs = [];
var currentVerbIdx = 0;
var showVerbAns = false;
var verbScore = 0;
var verbTotal = 0;
var matchPairs = [];
var selectedMatch = null;
var matchedPairs = [];
var testVerbs = [];
var testIdx = 0;

// ========== SOUND ==========
function playSound(type) {
  if (!soundEnabled) return;
  try {
    var ctx = new (window.AudioContext || window.webkitAudioContext)();
    var osc = ctx.createOscillator();
    var gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    
    if (type === 'correct') {
      osc.frequency.setValueAtTime(523, ctx.currentTime);
      osc.frequency.setValueAtTime(659, ctx.currentTime + 0.1);
      osc.frequency.setValueAtTime(784, ctx.currentTime + 0.2);
      gain.gain.setValueAtTime(0.3, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.4);
    } else if (type === 'wrong') {
      osc.frequency.setValueAtTime(311, ctx.currentTime);
      osc.frequency.setValueAtTime(277, ctx.currentTime + 0.15);
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.3);
    } else if (type === 'click') {
      osc.frequency.setValueAtTime(800, ctx.currentTime);
      gain.gain.setValueAtTime(0.1, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.05);
    } else if (type === 'flip') {
      osc.frequency.setValueAtTime(600, ctx.currentTime);
      osc.frequency.setValueAtTime(900, ctx.currentTime + 0.05);
      gain.gain.setValueAtTime(0.15, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.1);
    } else if (type === 'complete') {
      [523, 659, 784, 1047].forEach(function(freq, i) {
        var o = ctx.createOscillator();
        var g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
        g.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.2);
        o.start(ctx.currentTime + i * 0.15);
        o.stop(ctx.currentTime + i * 0.15 + 0.2);
      });
    } else if (type === 'match') {
      osc.frequency.setValueAtTime(440, ctx.currentTime);
      osc.frequency.setValueAtTime(554, ctx.currentTime + 0.08);
      osc.frequency.setValueAtTime(659, ctx.currentTime + 0.16);
      gain.gain.setValueAtTime(0.25, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.3);
    }
  } catch(e) {}
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
  playSound('click');
}

// ========== CONFETTI ==========
function showConfetti() {
  var container = document.getElementById('confettiContainer');
  container.innerHTML = '';
  var colors = ['#f6d365','#fda085','#667eea','#764ba2','#84fab0'];
  for (var i = 0; i < 30; i++) {
    var c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + '%';
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    c.style.animationDelay = Math.random() * 0.5 + 's';
    container.appendChild(c);
  }
  setTimeout(function() { container.innerHTML = ''; }, 3000);
}

// ========== NAVIGATION ==========
function showScreen(id) {
  var screens = document.querySelectorAll('.screen');
  for (var i = 0; i < screens.length; i++) {
    screens[i].classList.remove('active');
  }
  document.getElementById(id).classList.add('active');
}

function goHome() {
  showScreen('homeScreen');
}

// ========== SHUFFLE ==========
function shuffle(arr) {
  var a = arr.slice();
  for (var i = a.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var t = a[i]; a[i] = a[j]; a[j] = t;
  }
  return a;
}

// ========== GAME ==========
function initGame() {
  var all = [];
  QUESTIONS.multiple.forEach(function(q) { all.push({type:'multiple', data:q}); });
  QUESTIONS.fill.forEach(function(q) { all.push({type:'fill', data:q}); });
  QUESTIONS.truefalse.forEach(function(q) { all.push({type:'truefalse', data:q}); });
  QUESTIONS.picture.forEach(function(q) { all.push({type:'picture', data:q}); });
  QUESTIONS.sort.forEach(function(q) { all.push({type:'sort', data:q}); });
  
  gameQuestions = shuffle(all).slice(0, 10);
  currentQ = 0;
  score = 0;
  streak = 0;
  
  showScreen('gameScreen');
  renderQuestion();
}

function renderQuestion() {
  var q = gameQuestions[currentQ];
  var html = '<div class="game-header">' +
    '<button class="back-btn" onclick="goHome()">â† Vá»</button>' +
    '<div class="progress-info">' +
    '<span class="question-counter">CÃ¢u ' + (currentQ + 1) + '/' + gameQuestions.length + '</span>' +
    '<span class="score-display">â­ ' + score + '</span>' +
    (streak >= 2 ? '<span class="streak-display">ğŸ”¥ ' + streak + '</span>' : '') +
    '</div></div>' +
    '<div class="progress-bar-container"><div class="progress-bar" style="width:' + ((currentQ + 1) / gameQuestions.length * 100) + '%"></div></div>';
  
  html += '<div class="question-card">';
  
  if (q.type === 'multiple') {
    html += '<div class="question-type-badge">ğŸ¯ Chá»n Ä‘Ã¡p Ã¡n Ä‘Ãºng</div>' +
      '<h2 class="question-text">' + q.data.question + '</h2>' +
      '<div class="options-grid">';
    for (var i = 0; i < q.data.options.length; i++) {
      html += '<button class="option-btn" id="opt' + i + '" onclick="answerMultiple(' + i + ')">' + q.data.options[i] + '</button>';
    }
    html += '</div><div id="explanation"></div>';
  }
  else if (q.type === 'fill') {
    html += '<div class="question-type-badge">âœï¸ Äiá»n vÃ o chá»— trá»‘ng</div>' +
      '<h2 class="question-text">' + q.data.sentence + '</h2>' +
      '<div class="hint-box">ğŸ’¡ Gá»£i Ã½: ' + q.data.hint + '</div>' +
      '<div class="fill-input-container">' +
      '<input type="text" class="fill-input" id="fillInput" placeholder="Nháº­p Ä‘Ã¡p Ã¡n..." onkeypress="if(event.key===\'Enter\')answerFill()">' +
      '<button class="submit-btn" id="fillSubmit" onclick="answerFill()">Kiá»ƒm tra</button>' +
      '</div><div id="explanation"></div>';
  }
  else if (q.type === 'truefalse') {
    html += '<div class="question-type-badge">âœ… ÄÃºng hay Sai?</div>' +
      '<h2 class="question-text">' + q.data.statement + '</h2>' +
      '<div class="tf-buttons">' +
      '<button class="tf-btn true" id="tfTrue" onclick="answerTF(true)">âœ“ ÄÃºng</button>' +
      '<button class="tf-btn false" id="tfFalse" onclick="answerTF(false)">âœ— Sai</button>' +
      '</div><div id="explanation"></div>';
  }
  else if (q.type === 'picture') {
    html += '<div class="question-type-badge">ğŸ–¼ï¸ NhÃ¬n hÃ¬nh chá»n cÃ¢u</div>' +
      '<div class="picture-emoji">' + q.data.image + '</div>' +
      '<h2 class="question-text">' + q.data.question + '</h2>' +
      '<div class="options-grid vertical">';
    for (var i = 0; i < q.data.options.length; i++) {
      html += '<button class="option-btn" id="opt' + i + '" onclick="answerMultiple(' + i + ')">' + q.data.options[i] + '</button>';
    }
    html += '</div><div id="explanation"></div>';
  }
  else if (q.type === 'sort') {
    remainingWords = shuffle(q.data.words.slice());
    sortedPresent = [];
    sortedPast = [];
    selectedWord = null;
    html += '<div class="question-type-badge">ğŸ® PhÃ¢n loáº¡i tá»«</div>' +
      '<h2 class="question-text">' + q.data.instruction + '</h2>' +
      '<p class="sort-hint">ğŸ‘† KÃ©o tháº£ hoáº·c cháº¡m vÃ o tá»« rá»“i cháº¡m vÃ o Ã´!</p>' +
      '<div class="words-pool" id="wordsPool"></div>' +
      '<div class="sort-containers">' +
      '<div class="sort-box present" onclick="dropWord(\'present\')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" ondrop="dropOnBox(event, \'present\')"><h3>ğŸŒŸ Hiá»‡n táº¡i</h3><div class="sorted-words" id="presentWords"></div></div>' +
      '<div class="sort-box past" onclick="dropWord(\'past\')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" ondrop="dropOnBox(event, \'past\')"><h3>â° QuÃ¡ khá»©</h3><div class="sorted-words" id="pastWords"></div></div>' +
      '</div>' +
      '<button class="submit-btn" id="sortSubmit" onclick="checkSort()" style="display:none;width:100%">Kiá»ƒm tra</button>' +
      '<div id="explanation"></div>';
  }
  
  html += '</div>';
  document.getElementById('gameScreen').innerHTML = html;
  
  if (q.type === 'sort') renderSortWords();
}

function renderSortWords() {
  var poolHtml = '';
  for (var i = 0; i < remainingWords.length; i++) {
    var w = remainingWords[i];
    poolHtml += '<div class="draggable-word' + (selectedWord === w ? ' selected' : '') + '" draggable="true" ondragstart="dragStart(event, \'' + w + '\')" ondragend="dragEnd(event)" onclick="selectWord(\'' + w + '\')">' + w + '</div>';
  }
  document.getElementById('wordsPool').innerHTML = poolHtml;
  
  var presHtml = '';
  for (var i = 0; i < sortedPresent.length; i++) {
    presHtml += '<span class="sorted-word">' + sortedPresent[i] + '</span>';
  }
  document.getElementById('presentWords').innerHTML = presHtml;
  
  var pastHtml = '';
  for (var i = 0; i < sortedPast.length; i++) {
    pastHtml += '<span class="sorted-word">' + sortedPast[i] + '</span>';
  }
  document.getElementById('pastWords').innerHTML = pastHtml;
  
  document.getElementById('sortSubmit').style.display = remainingWords.length === 0 ? 'block' : 'none';
}

var draggedWord = null;

function dragStart(e, word) {
  draggedWord = word;
  e.target.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}

function dragEnd(e) {
  e.target.classList.remove('dragging');
  draggedWord = null;
  // Remove drag-over class from all boxes
  var boxes = document.querySelectorAll('.sort-box');
  for (var i = 0; i < boxes.length; i++) {
    boxes[i].classList.remove('drag-over');
  }
}

function allowDrop(e) {
  e.preventDefault();
  e.currentTarget.classList.add('drag-over');
}

function dragLeave(e) {
  e.currentTarget.classList.remove('drag-over');
}

function dropOnBox(e, target) {
  e.preventDefault();
  e.currentTarget.classList.remove('drag-over');
  if (draggedWord) {
    playSound('click');
    if (target === 'present') sortedPresent.push(draggedWord);
    else sortedPast.push(draggedWord);
    remainingWords = remainingWords.filter(function(x) { return x !== draggedWord; });
    draggedWord = null;
    selectedWord = null;
    renderSortWords();
  }
}

function selectWord(w) {
  playSound('click');
  selectedWord = selectedWord === w ? null : w;
  renderSortWords();
}

function dropWord(target) {
  if (!selectedWord) return;
  playSound('click');
  if (target === 'present') sortedPresent.push(selectedWord);
  else sortedPast.push(selectedWord);
  remainingWords = remainingWords.filter(function(x) { return x !== selectedWord; });
  selectedWord = null;
  renderSortWords();
}

function answerMultiple(idx) {
  var q = gameQuestions[currentQ];
  var correct = idx === q.data.correct;
  
  var btns = document.querySelectorAll('.option-btn');
  for (var i = 0; i < btns.length; i++) {
    btns[i].disabled = true;
    if (i === q.data.correct) btns[i].classList.add('correct');
    if (i === idx && !correct) btns[i].classList.add('wrong');
  }
  
  showAnswerFeedback(correct, q.data.explanation);
}

function answerFill() {
  var q = gameQuestions[currentQ];
  var input = document.getElementById('fillInput');
  var correct = input.value.toLowerCase().trim() === q.data.answer.toLowerCase();
  
  input.disabled = true;
  document.getElementById('fillSubmit').style.display = 'none';
  
  showAnswerFeedback(correct, correct ? 'ğŸ‰ Tuyá»‡t vá»i!' : 'ğŸ’¡ ÄÃ¡p Ã¡n Ä‘Ãºng: ' + q.data.answer);
}

function answerTF(ans) {
  var q = gameQuestions[currentQ];
  var correct = ans === q.data.correct;
  
  document.getElementById('tfTrue').disabled = true;
  document.getElementById('tfFalse').disabled = true;
  
  if (q.data.correct === true) document.getElementById('tfTrue').classList.add('correct');
  else document.getElementById('tfFalse').classList.add('correct');
  
  if (!correct) {
    document.getElementById(ans ? 'tfTrue' : 'tfFalse').classList.add('wrong');
  }
  
  showAnswerFeedback(correct, q.data.explanation);
}

function checkSort() {
  var q = gameQuestions[currentQ];
  var presOk = sortedPresent.length === q.data.presentWords.length && sortedPresent.every(function(w) { return q.data.presentWords.indexOf(w) >= 0; });
  var pastOk = sortedPast.length === q.data.pastWords.length && sortedPast.every(function(w) { return q.data.pastWords.indexOf(w) >= 0; });
  var correct = presOk && pastOk;
  
  var presHtml = '';
  for (var i = 0; i < sortedPresent.length; i++) {
    var w = sortedPresent[i];
    presHtml += '<span class="sorted-word ' + (q.data.presentWords.indexOf(w) >= 0 ? 'correct' : 'wrong') + '">' + w + '</span>';
  }
  document.getElementById('presentWords').innerHTML = presHtml;
  
  var pastHtml = '';
  for (var i = 0; i < sortedPast.length; i++) {
    var w = sortedPast[i];
    pastHtml += '<span class="sorted-word ' + (q.data.pastWords.indexOf(w) >= 0 ? 'correct' : 'wrong') + '">' + w + '</span>';
  }
  document.getElementById('pastWords').innerHTML = pastHtml;
  
  document.getElementById('sortSubmit').style.display = 'none';
  showAnswerFeedback(correct, correct ? 'ğŸ‰ Xuáº¥t sáº¯c!' : 'ğŸ’¡ yesterday, last, ago â†’ QuÃ¡ khá»© | every, always, now â†’ Hiá»‡n táº¡i');
}

function showAnswerFeedback(correct, text) {
  if (correct) {
    score++;
    streak++;
    playSound('correct');
    if (streak >= 3) showConfetti();
  } else {
    streak = 0;
    playSound('wrong');
  }
  
  document.getElementById('explanation').innerHTML = '<div class="explanation ' + (correct ? 'correct' : 'wrong') + '">' + (correct ? 'ğŸ‰ ' : 'ğŸ’¡ ') + text + '</div>' +
    '<button class="next-btn" onclick="nextQuestion()">' + (currentQ < gameQuestions.length - 1 ? 'CÃ¢u tiáº¿p theo â†’' : 'Xem káº¿t quáº£ ğŸ†') + '</button>';
}

function nextQuestion() {
  if (currentQ < gameQuestions.length - 1) {
    currentQ++;
    renderQuestion();
  } else {
    playSound('complete');
    showGameResult();
  }
}

function showGameResult() {
  var pct = Math.round(score / gameQuestions.length * 100);
  var stars = Math.min(3, Math.floor(pct / 33));
  
  var html = '<div class="result-screen"><div class="result-card">' +
    '<h2 class="result-title">ğŸ‰ HoÃ n thÃ nh!</h2>' +
    '<div class="result-emoji">' + (pct >= 80 ? 'ğŸ†' : pct >= 50 ? 'ğŸŒŸ' : 'ğŸ’ª') + '</div>' +
    '<div class="stars-display">';
  for (var i = 0; i < 3; i++) html += i < stars ? 'â­' : 'â˜†';
  html += '</div>' +
    '<p class="result-score">Äiá»ƒm: <strong>' + score + '/' + gameQuestions.length + '</strong></p>' +
    '<p class="result-message">' + (pct >= 80 ? 'Xuáº¥t sáº¯c! Con giá»i quÃ¡! ğŸŠ' : pct >= 50 ? 'Tá»‘t láº¯m! Cá»‘ gáº¯ng thÃªm nhÃ©! ğŸ’ª' : 'Cáº§n Ã´n láº¡i bÃ i há»c nha! ğŸ“š') + '</p>' +
    '<div class="result-buttons">' +
    '<button class="menu-btn play" onclick="initGame()">ğŸ”„ ChÆ¡i láº¡i</button>' +
    '<button class="menu-btn learn" onclick="showLesson()">ğŸ“– Ã”n bÃ i</button>' +
    '<button class="menu-btn learn" onclick="goHome()">ğŸ  Vá» nhÃ </button>' +
    '</div></div></div>';
  
  document.getElementById('resultScreen').innerHTML = html;
  showScreen('resultScreen');
}

// ========== LESSON ==========
function showLesson() {
  var html = '<button class="back-btn" onclick="goHome()" style="margin-bottom:20px">â† Vá» trang chá»§</button>' +
    
    // === BÃ KÃP NHá»š NHANH ===
    '<div class="lesson-card">' +
    '<h2 class="lesson-title">ğŸ¯ BÃ KÃP NHá»š NHANH</h2>' +
    '<div style="background:linear-gradient(135deg,#fff9c4,#ffecd2);padding:20px;border-radius:15px;margin-bottom:20px">' +
    '<p style="font-size:1.3rem;font-weight:700;color:#8b6914;text-align:center">ğŸ§  HÃ£y nhá»› cÃ¢u tháº§n chÃº nÃ y:</p>' +
    '<p style="font-size:1.5rem;font-weight:800;color:#d35400;text-align:center;margin:15px 0">"EVERY â†’ Hiá»‡n táº¡i ğŸŒŸ"</p>' +
    '<p style="font-size:1.5rem;font-weight:800;color:#8e44ad;text-align:center;margin:15px 0">"LAST / AGO â†’ QuÃ¡ khá»© â°"</p>' +
    '</div>' +
    '<div style="background:#e8f5e9;padding:15px;border-radius:12px;margin-bottom:10px">' +
    '<p style="font-weight:700;color:#2e7d32">ğŸ’¡ Máº¹o nhá»›:</p>' +
    '<p style="color:#388e3c">â€¢ Tháº¥y <strong>EVERY</strong> (má»—i) â†’ Viá»‡c láº·p Ä‘i láº·p láº¡i â†’ <strong>Hiá»‡n táº¡i</strong></p>' +
    '<p style="color:#388e3c">â€¢ Tháº¥y <strong>LAST</strong> (trÆ°á»›c) hoáº·c <strong>AGO</strong> (cÃ¡ch Ä‘Ã¢y) â†’ ÄÃ£ xong rá»“i â†’ <strong>QuÃ¡ khá»©</strong></p>' +
    '</div>' +
    '</div>' +

    // === THÃŒ HIá»†N Táº I ===
    '<div class="lesson-card">' +
    '<h2 class="lesson-title">ğŸŒŸ ThÃ¬ HIá»†N Táº I (Present)</h2>' +
    '<p style="font-size:1.1rem;color:#4a5568;margin-bottom:15px"><strong>DÃ¹ng khi:</strong> Viá»‡c xáº£y ra <span style="color:#38a169;font-weight:700">thÆ°á»ng xuyÃªn, má»—i ngÃ y</span>, hoáº·c lÃ  <span style="color:#38a169;font-weight:700">sá»± tháº­t luÃ´n Ä‘Ãºng</span></p>' +
    
    '<div class="tense-box present">' +
    '<h3>ğŸ“Œ Tá»« nháº­n biáº¿t (Gáº·p tá»« nÃ y â†’ DÃ¹ng Hiá»‡n táº¡i!)</h3>' +
    '<div class="signal-words">';
  
  var presentSignals = ['every day', 'every morning', 'every night', 'every week', 'always', 'usually', 'often', 'sometimes', 'now'];
  presentSignals.forEach(function(w) { html += '<span class="signal-word present">' + w + '</span>'; });
  
  html += '</div></div>' +
    
    // CÃ¢u kháº³ng Ä‘á»‹nh
    '<div style="background:#e8f5e9;padding:20px;border-radius:15px;margin:15px 0">' +
    '<h4 style="color:#2e7d32;margin-bottom:10px">âœ… CÃ¢u KHáº²NG Äá»ŠNH (CÃ³ lÃ m):</h4>' +
    '<p style="color:#1b5e20;margin-bottom:8px"><strong>I / You / We / They</strong> + Ä‘á»™ng tá»« gá»‘c</p>' +
    '<p style="color:#1b5e20;margin-bottom:8px"><strong>He / She / It</strong> + Ä‘á»™ng tá»« thÃªm <strong>-s/-es</strong></p>' +
    '<div class="examples">' +
    '<p class="example-sentence">âœ“ I <strong>go</strong> to school every day. <span style="color:#888">(TÃ´i Ä‘i há»c má»—i ngÃ y)</span></p>' +
    '<p class="example-sentence">âœ“ She <strong>goes</strong> to school every day. <span style="color:#888">(CÃ´ áº¥y Ä‘i há»c má»—i ngÃ y)</span></p>' +
    '<p class="example-sentence">âœ“ He <strong>watches</strong> TV every night. <span style="color:#888">(Anh áº¥y xem TV má»—i tá»‘i)</span></p>' +
    '</div></div>' +
    
    // CÃ¢u phá»§ Ä‘á»‹nh
    '<div style="background:#ffebee;padding:20px;border-radius:15px;margin:15px 0">' +
    '<h4 style="color:#c62828;margin-bottom:10px">âŒ CÃ¢u PHá»¦ Äá»ŠNH (KhÃ´ng lÃ m):</h4>' +
    '<p style="color:#b71c1c;margin-bottom:8px"><strong>I / You / We / They</strong> + <span style="background:#ffcdd2;padding:2px 8px;border-radius:5px">do not (don\'t)</span> + Ä‘á»™ng tá»« gá»‘c</p>' +
    '<p style="color:#b71c1c;margin-bottom:8px"><strong>He / She / It</strong> + <span style="background:#ffcdd2;padding:2px 8px;border-radius:5px">does not (doesn\'t)</span> + Ä‘á»™ng tá»« gá»‘c</p>' +
    '<div class="examples" style="background:#fff">' +
    '<p class="example-sentence">âœ— I <strong>don\'t go</strong> to school on Sunday. <span style="color:#888">(TÃ´i khÃ´ng Ä‘i há»c vÃ o CN)</span></p>' +
    '<p class="example-sentence">âœ— She <strong>doesn\'t like</strong> spiders. <span style="color:#888">(CÃ´ áº¥y khÃ´ng thÃ­ch nhá»‡n)</span></p>' +
    '<p class="example-sentence">âœ— He <strong>doesn\'t eat</strong> vegetables. <span style="color:#888">(Anh áº¥y khÃ´ng Äƒn rau)</span></p>' +
    '</div>' +
    '<div style="background:#fff3e0;padding:12px;border-radius:10px;margin-top:10px">' +
    '<p style="color:#e65100;font-weight:700">âš ï¸ CHÃš Ã: Sau don\'t/doesn\'t â†’ Ä‘á»™ng tá»« giá»¯ NGUYÃŠN (khÃ´ng thÃªm s/es)</p>' +
    '<p style="color:#ef6c00">âŒ Sai: She doesn\'t <s>goes</s> â†’ âœ… ÄÃºng: She doesn\'t <strong>go</strong></p>' +
    '</div></div>' +
    '</div>' +

    // === THÃŒ QUÃ KHá»¨ ===
    '<div class="lesson-card">' +
    '<h2 class="lesson-title">â° ThÃ¬ QUÃ KHá»¨ (Past)</h2>' +
    '<p style="font-size:1.1rem;color:#4a5568;margin-bottom:15px"><strong>DÃ¹ng khi:</strong> Viá»‡c <span style="color:#e65100;font-weight:700">Ä‘Ã£ xáº£y ra vÃ  káº¿t thÃºc</span> trong quÃ¡ khá»© (hÃ´m qua, tuáº§n trÆ°á»›c...)</p>' +
    
    '<div class="tense-box past">' +
    '<h3>ğŸ“Œ Tá»« nháº­n biáº¿t (Gáº·p tá»« nÃ y â†’ DÃ¹ng QuÃ¡ khá»©!)</h3>' +
    '<div class="signal-words">';
  
  var pastSignals = ['yesterday', 'last night', 'last week', 'last month', 'last year', 'ago', 'in 2020'];
  pastSignals.forEach(function(w) { html += '<span class="signal-word past">' + w + '</span>'; });
  
  html += '</div></div>' +
    
    // CÃ¢u kháº³ng Ä‘á»‹nh
    '<div style="background:#fff3e0;padding:20px;border-radius:15px;margin:15px 0">' +
    '<h4 style="color:#e65100;margin-bottom:10px">âœ… CÃ¢u KHáº²NG Äá»ŠNH (ÄÃ£ lÃ m):</h4>' +
    '<p style="color:#bf360c;margin-bottom:8px">Táº¥t cáº£ chá»§ ngá»¯ + Ä‘á»™ng tá»« <strong>thÃªm -ed</strong> (cÃ³ quy táº¯c) hoáº·c <strong>Ä‘á»•i dáº¡ng</strong> (báº¥t quy táº¯c)</p>' +
    '<div class="examples">' +
    '<p class="example-sentence">âœ“ I <strong>played</strong> games yesterday. <span style="color:#888">(play â†’ played)</span></p>' +
    '<p class="example-sentence">âœ“ She <strong>watched</strong> TV last night. <span style="color:#888">(watch â†’ watched)</span></p>' +
    '<p class="example-sentence">âœ“ We <strong>went</strong> to the zoo last week. <span style="color:#888">(go â†’ went âš¡)</span></p>' +
    '</div></div>' +
    
    // CÃ¢u phá»§ Ä‘á»‹nh
    '<div style="background:#fce4ec;padding:20px;border-radius:15px;margin:15px 0">' +
    '<h4 style="color:#c2185b;margin-bottom:10px">âŒ CÃ¢u PHá»¦ Äá»ŠNH (ÄÃ£ khÃ´ng lÃ m):</h4>' +
    '<p style="color:#880e4f;margin-bottom:8px">Táº¥t cáº£ chá»§ ngá»¯ + <span style="background:#f8bbd9;padding:2px 8px;border-radius:5px">did not (didn\'t)</span> + Ä‘á»™ng tá»« <strong>Gá»C</strong></p>' +
    '<div class="examples" style="background:#fff">' +
    '<p class="example-sentence">âœ— I <strong>didn\'t play</strong> games yesterday. <span style="color:#888">(TÃ´i Ä‘Ã£ khÃ´ng chÆ¡i game)</span></p>' +
    '<p class="example-sentence">âœ— She <strong>didn\'t watch</strong> TV last night. <span style="color:#888">(CÃ´ áº¥y Ä‘Ã£ khÃ´ng xem TV)</span></p>' +
    '<p class="example-sentence">âœ— We <strong>didn\'t go</strong> to school yesterday. <span style="color:#888">(ChÃºng tÃ´i Ä‘Ã£ khÃ´ng Ä‘i há»c)</span></p>' +
    '</div>' +
    '<div style="background:#fff3e0;padding:12px;border-radius:10px;margin-top:10px">' +
    '<p style="color:#e65100;font-weight:700">âš ï¸ CHÃš Ã: Sau didn\'t â†’ Ä‘á»™ng tá»« vá» Dáº NG Gá»C (khÃ´ng chia)</p>' +
    '<p style="color:#ef6c00">âŒ Sai: I didn\'t <s>went</s> â†’ âœ… ÄÃºng: I didn\'t <strong>go</strong></p>' +
    '<p style="color:#ef6c00">âŒ Sai: She didn\'t <s>watched</s> â†’ âœ… ÄÃºng: She didn\'t <strong>watch</strong></p>' +
    '</div></div>' +
    '</div>' +

    // === Báº¢NG SO SÃNH ===
    '<div class="lesson-card">' +
    '<h2 class="lesson-title">ğŸ“Š Báº¢NG SO SÃNH Dá»„ NHá»š</h2>' +
    '<table class="irregular-table" style="margin-bottom:20px">' +
    '<thead><tr><th></th><th style="background:#4caf50">ğŸŒŸ Hiá»‡n táº¡i</th><th style="background:#ff9800">â° QuÃ¡ khá»©</th></tr></thead>' +
    '<tbody>' +
    '<tr><td style="font-weight:700">Tá»« nháº­n biáº¿t</td><td>every day, always, usually</td><td>yesterday, last..., ago</td></tr>' +
    '<tr><td style="font-weight:700">Kháº³ng Ä‘á»‹nh (I)</td><td>I <strong>go</strong></td><td>I <strong>went</strong></td></tr>' +
    '<tr><td style="font-weight:700">Kháº³ng Ä‘á»‹nh (She)</td><td>She <strong>goes</strong></td><td>She <strong>went</strong></td></tr>' +
    '<tr><td style="font-weight:700">Phá»§ Ä‘á»‹nh (I)</td><td>I <strong>don\'t go</strong></td><td>I <strong>didn\'t go</strong></td></tr>' +
    '<tr><td style="font-weight:700">Phá»§ Ä‘á»‹nh (She)</td><td>She <strong>doesn\'t go</strong></td><td>She <strong>didn\'t go</strong></td></tr>' +
    '</tbody></table>' +
    
    '<div style="background:linear-gradient(135deg,#e3f2fd,#bbdefb);padding:20px;border-radius:15px">' +
    '<h4 style="color:#1565c0;margin-bottom:10px">ğŸ¯ QUY Táº®C VÃ€NG CHO CÃ‚U PHá»¦ Äá»ŠNH:</h4>' +
    '<p style="font-size:1.2rem;color:#0d47a1;font-weight:700;text-align:center">' +
    'Sau <span style="background:#90caf9;padding:3px 10px;border-radius:8px">don\'t / doesn\'t / didn\'t</span> â†’ Äá»™ng tá»« luÃ´n á»Ÿ <span style="background:#fff59d;padding:3px 10px;border-radius:8px">Dáº NG Gá»C</span>!</p>' +
    '</div></div>' +

    // === Äá»˜NG Tá»ª Báº¤T QUY Táº®C ===
    '<div class="lesson-card">' +
    '<h2 class="lesson-title">ğŸ”„ Äá»™ng tá»« Báº¤T QUY Táº®C (pháº£i há»c thuá»™c!)</h2>' +
    '<p style="color:#718096;margin-bottom:15px">Nhá»¯ng Ä‘á»™ng tá»« nÃ y khÃ´ng thÃªm -ed mÃ  pháº£i nhá»› dáº¡ng riÃªng:</p>' +
    '<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">';
  
  var importantVerbs = [
    {base:'go',past:'went',vn:'Ä‘i'}, {base:'eat',past:'ate',vn:'Äƒn'}, {base:'see',past:'saw',vn:'tháº¥y'},
    {base:'have',past:'had',vn:'cÃ³'}, {base:'do',past:'did',vn:'lÃ m'}, {base:'make',past:'made',vn:'lÃ m/táº¡o'},
    {base:'take',past:'took',vn:'láº¥y'}, {base:'come',past:'came',vn:'Ä‘áº¿n'}, {base:'get',past:'got',vn:'láº¥y/Ä‘Æ°á»£c'},
    {base:'give',past:'gave',vn:'cho'}, {base:'run',past:'ran',vn:'cháº¡y'}, {base:'swim',past:'swam',vn:'bÆ¡i'},
    {base:'drink',past:'drank',vn:'uá»‘ng'}, {base:'sing',past:'sang',vn:'hÃ¡t'}, {base:'write',past:'wrote',vn:'viáº¿t'},
    {base:'read',past:'read',vn:'Ä‘á»c'}, {base:'sleep',past:'slept',vn:'ngá»§'}, {base:'buy',past:'bought',vn:'mua'}
  ];
  
  importantVerbs.forEach(function(v) {
    html += '<div style="background:#f5f5f5;padding:10px 15px;border-radius:10px;display:flex;justify-content:space-between;align-items:center">' +
      '<span style="color:#4caf50;font-weight:700">' + v.base + '</span>' +
      '<span style="color:#888">â†’</span>' +
      '<span style="color:#ff9800;font-weight:700">' + v.past + '</span>' +
      '<span style="color:#9e9e9e;font-size:0.85rem">(' + v.vn + ')</span></div>';
  });
  
  html += '</div></div>' +
    
    '<button class="menu-btn play" onclick="initGame()" style="width:100%;margin-bottom:10px">ğŸ® Luyá»‡n táº­p ngay!</button>' +
    '<button class="menu-btn verbs" onclick="showVerbMenu()" style="width:100%">ğŸ”„ Há»c Ä‘á»™ng tá»« báº¥t quy táº¯c</button>';
  
  document.getElementById('lessonScreen').innerHTML = html;
  showScreen('lessonScreen');
}

// ========== VERB LEARNING ==========
function showVerbMenu() {
  shuffledVerbs = shuffle(IRREGULAR_VERBS.slice());
  currentVerbIdx = 0;
  verbMode = 'menu';
  renderVerbScreen();
  showScreen('verbScreen');
}

function renderVerbScreen() {
  var html = '';
  
  if (verbMode === 'menu') {
    html = '<div class="verb-menu"><h2 class="verb-title">ğŸ”„ Há»c Äá»™ng Tá»« Báº¥t Quy Táº¯c</h2>' +
      '<p class="verb-subtitle">Chá»n cÃ¡ch há»c phÃ¹ há»£p!</p>' +
      '<div class="verb-stats"><span>ğŸ“š Tá»•ng: ' + IRREGULAR_VERBS.length + ' tá»«</span></div>' +
      '<div class="verb-mode-buttons">' +
      '<button class="verb-mode-btn flashcard" onclick="startVerbMode(\'flashcard\')"><span class="mode-icon">ğŸ´</span><span class="mode-name">Flashcard</span><span class="mode-desc">Láº­t tháº» ghi nhá»›</span></button>' +
      '<button class="verb-mode-btn match" onclick="startVerbMode(\'match\')"><span class="mode-icon">ğŸ¯</span><span class="mode-name">Ná»‘i tá»«</span><span class="mode-desc">GhÃ©p Ä‘Ã´i Ä‘Ãºng</span></button>' +
      '<button class="verb-mode-btn fill" onclick="startVerbMode(\'fill\')"><span class="mode-icon">âœï¸</span><span class="mode-name">Äiá»n tá»«</span><span class="mode-desc">Viáº¿t dáº¡ng quÃ¡ khá»©</span></button>' +
      '<button class="verb-mode-btn test" onclick="startVerbMode(\'test\')"><span class="mode-icon">ğŸ“</span><span class="mode-name">Kiá»ƒm tra</span><span class="mode-desc">10 cÃ¢u ngáº«u nhiÃªn</span></button>' +
      '</div><button class="back-btn" onclick="goHome()" style="margin-top:30px">â† Vá» trang chá»§</button></div>';
  }
  else if (verbMode === 'flashcard') {
    var v = shuffledVerbs[currentVerbIdx];
    html = '<div class="flashcard-mode"><div class="flashcard-header">' +
      '<button class="back-btn" onclick="verbMode=\'menu\';renderVerbScreen()">â† Vá»</button>' +
      '<span class="flashcard-progress">' + (currentVerbIdx + 1) + ' / ' + shuffledVerbs.length + '</span></div>' +
      '<div class="flashcard' + (showVerbAns ? ' flipped' : '') + '" onclick="flipCard()">' +
      '<div class="flashcard-inner"><div class="flashcard-front"><span class="flashcard-label">Hiá»‡n táº¡i</span><span class="flashcard-word">' + v.base + '</span><span class="flashcard-hint">ğŸ‘† Cháº¡m Ä‘á»ƒ láº­t</span></div>' +
      '<div class="flashcard-back"><span class="flashcard-label">QuÃ¡ khá»©</span><span class="flashcard-word">' + v.past + '</span><span class="flashcard-pair">' + v.base + ' â†’ ' + v.past + '</span></div></div></div>' +
      '<div class="flashcard-buttons"><button class="flashcard-btn prev" onclick="prevCard()">â† TrÆ°á»›c</button>' +
      '<button class="flashcard-btn shuffle" onclick="shuffleCards()">ğŸ”€ Trá»™n</button>' +
      '<button class="flashcard-btn next" onclick="nextCard()">Sau â†’</button></div></div>';
  }
  else if (verbMode === 'match') {
    html = '<div class="match-mode"><div class="match-header">' +
      '<button class="back-btn" onclick="verbMode=\'menu\';renderVerbScreen()">â† Vá»</button>' +
      '<span class="match-score">âœ… ' + matchedPairs.length + ' / 6</span></div>' +
      '<h3 class="match-title">ğŸ¯ Ná»‘i tá»« hiá»‡n táº¡i vá»›i quÃ¡ khá»©!</h3><div class="match-grid">';
    for (var i = 0; i < matchPairs.length; i++) {
      var c = matchPairs[i];
      html += '<button class="match-card ' + c.type + (selectedMatch && selectedMatch.id === c.id ? ' selected' : '') + (matchedPairs.indexOf(c.pairId) >= 0 ? ' matched' : '') + '" onclick="handleMatch(\'' + c.id + '\',' + c.pairId + ',\'' + c.type + '\')"' + (matchedPairs.indexOf(c.pairId) >= 0 ? ' disabled' : '') + '>' + c.text + '</button>';
    }
    html += '</div>';
    if (matchedPairs.length >= 6) {
      html += '<div class="match-complete"><p>ğŸ‰ Xuáº¥t sáº¯c!</p><button class="menu-btn play" onclick="startVerbMode(\'match\')">ğŸ”„ ChÆ¡i láº¡i</button></div>';
    }
    html += '</div>';
  }
  else if (verbMode === 'fill' || verbMode === 'test') {
    var v = verbMode === 'test' ? testVerbs[testIdx] : shuffledVerbs[currentVerbIdx];
    html = '<div class="verb-fill-mode"><div class="verb-fill-header">' +
      '<button class="back-btn" onclick="verbMode=\'menu\';renderVerbScreen()">â† Vá»</button>' +
      (verbMode === 'test' ? '<span class="verb-fill-progress">CÃ¢u ' + (testIdx + 1) + ' / 10</span>' : '') +
      '<span class="verb-fill-score">âœ… ' + verbScore + ' / ' + verbTotal + '</span></div>' +
      (verbMode === 'test' ? '<div class="progress-bar-container"><div class="progress-bar" style="width:' + ((testIdx + 1) / 10 * 100) + '%"></div></div>' : '') +
      '<div class="verb-fill-card"><h3>' + (verbMode === 'test' ? 'ğŸ“' : 'âœï¸') + ' Viáº¿t dáº¡ng quÃ¡ khá»© cá»§a:</h3>' +
      '<div class="verb-fill-word">' + v.base + '</div>' +
      '<input type="text" class="verb-fill-input" id="verbInput" placeholder="Nháº­p Ä‘Ã¡p Ã¡n..." onkeypress="if(event.key===\'Enter\')checkVerbFill()">' +
      '<button class="submit-btn" id="verbSubmit" onclick="checkVerbFill()" style="width:100%">Kiá»ƒm tra</button>' +
      '<div id="verbResult"></div></div></div>';
  }
  else if (verbMode === 'testResult') {
    var pct = Math.round(verbScore / 10 * 100);
    var stars = Math.min(3, Math.floor(pct / 33));
    html = '<div class="result-screen"><div class="result-card"><h2 class="result-title">ğŸ“ Káº¿t quáº£</h2>' +
      '<div class="result-emoji">' + (pct >= 80 ? 'ğŸ†' : pct >= 50 ? 'ğŸŒŸ' : 'ğŸ’ª') + '</div><div class="stars-display">';
    for (var i = 0; i < 3; i++) html += i < stars ? 'â­' : 'â˜†';
    html += '</div><p class="result-score">Äiá»ƒm: <strong>' + verbScore + ' / 10</strong> (' + pct + '%)</p>' +
      '<p class="result-message">' + (pct >= 80 ? 'Xuáº¥t sáº¯c! ğŸŠ' : pct >= 50 ? 'Tá»‘t láº¯m! ğŸ’ª' : 'Cáº§n Ã´n thÃªm! ğŸ“š') + '</p>' +
      '<div class="result-buttons"><button class="menu-btn play" onclick="startVerbMode(\'test\')">ğŸ”„ Thi láº¡i</button>' +
      '<button class="menu-btn learn" onclick="startVerbMode(\'flashcard\')">ğŸ´ Ã”n Flashcard</button>' +
      '<button class="menu-btn learn" onclick="verbMode=\'menu\';renderVerbScreen()">â† Menu</button></div></div></div>';
  }
  
  document.getElementById('verbScreen').innerHTML = html;
}

function startVerbMode(mode) {
  verbMode = mode;
  verbScore = 0;
  verbTotal = 0;
  
  if (mode === 'match') {
    var sel = shuffle(IRREGULAR_VERBS.slice()).slice(0, 6);
    var bases = sel.map(function(v, i) { return {id: 'b' + i, text: v.base, type: 'base', pairId: i}; });
    var pasts = sel.map(function(v, i) { return {id: 'p' + i, text: v.past, type: 'past', pairId: i}; });
    matchPairs = shuffle(bases.concat(pasts));
    selectedMatch = null;
    matchedPairs = [];
  }
  if (mode === 'test') {
    testVerbs = shuffle(IRREGULAR_VERBS.slice()).slice(0, 10);
    testIdx = 0;
  }
  if (mode === 'flashcard') {
    shuffledVerbs = shuffle(IRREGULAR_VERBS.slice());
    currentVerbIdx = 0;
    showVerbAns = false;
  }
  if (mode === 'fill') {
    shuffledVerbs = shuffle(IRREGULAR_VERBS.slice());
    currentVerbIdx = 0;
  }
  
  renderVerbScreen();
}

function flipCard() {
  playSound('flip');
  showVerbAns = !showVerbAns;
  renderVerbScreen();
}

function prevCard() {
  showVerbAns = false;
  currentVerbIdx = currentVerbIdx > 0 ? currentVerbIdx - 1 : shuffledVerbs.length - 1;
  renderVerbScreen();
}

function nextCard() {
  showVerbAns = false;
  currentVerbIdx = currentVerbIdx < shuffledVerbs.length - 1 ? currentVerbIdx + 1 : 0;
  renderVerbScreen();
}

function shuffleCards() {
  shuffledVerbs = shuffle(IRREGULAR_VERBS.slice());
  currentVerbIdx = 0;
  showVerbAns = false;
  renderVerbScreen();
}

function handleMatch(id, pairId, type) {
  playSound('click');
  
  if (!selectedMatch) {
    selectedMatch = {id: id, pairId: pairId, type: type};
    renderVerbScreen();
    return;
  }
  
  if (selectedMatch.id === id) {
    selectedMatch = null;
    renderVerbScreen();
    return;
  }
  
  if (selectedMatch.pairId === pairId && selectedMatch.type !== type) {
    matchedPairs.push(pairId);
    selectedMatch = null;
    playSound('match');
    if (matchedPairs.length >= 6) {
      playSound('complete');
      showConfetti();
    }
  } else {
    playSound('wrong');
    selectedMatch = null;
  }
  
  renderVerbScreen();
}

function checkVerbFill() {
  var input = document.getElementById('verbInput');
  var v = verbMode === 'test' ? testVerbs[testIdx] : shuffledVerbs[currentVerbIdx];
  var correct = input.value.toLowerCase().trim() === v.past.toLowerCase();
  
  verbTotal++;
  if (correct) {
    verbScore++;
    playSound('correct');
  } else {
    playSound('wrong');
  }
  
  input.disabled = true;
  document.getElementById('verbSubmit').style.display = 'none';
  
  document.getElementById('verbResult').innerHTML = '<div class="verb-fill-result ' + (correct ? 'correct' : 'wrong') + '">' +
    '<p>' + (correct ? 'ğŸ‰ ÄÃºng rá»“i!' : 'ğŸ’¡ ÄÃ¡p Ã¡n: <strong>' + v.base + ' â†’ ' + v.past + '</strong>') + '</p>' +
    '<button class="next-btn" onclick="nextVerbFill()">' + (verbMode === 'test' && testIdx >= 9 ? 'Xem káº¿t quáº£ ğŸ†' : 'Tá»« tiáº¿p theo â†’') + '</button></div>';
}

function nextVerbFill() {
  if (verbMode === 'test') {
    if (testIdx < 9) {
      testIdx++;
      renderVerbScreen();
    } else {
      verbMode = 'testResult';
      playSound('complete');
      renderVerbScreen();
    }
  } else {
    currentVerbIdx = currentVerbIdx < shuffledVerbs.length - 1 ? currentVerbIdx + 1 : 0;
    renderVerbScreen();
  }
}
</script>
</body>
</html>
