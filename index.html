<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ü¶â English Tenses - H·ªçc Th√¨ Ti·∫øng Anh</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶â</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }
    
    .app-container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }
    
    /* Floating shapes */
    .floating-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    .shape {
      position: absolute;
      opacity: 0.3;
      animation: float 6s ease-in-out infinite;
    }
    
    .shape:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; font-size: 40px; }
    .shape:nth-child(2) { top: 20%; right: 15%; animation-delay: 1s; font-size: 35px; }
    .shape:nth-child(3) { bottom: 30%; left: 5%; animation-delay: 2s; font-size: 45px; }
    .shape:nth-child(4) { bottom: 15%; right: 10%; animation-delay: 3s; font-size: 38px; }
    .shape:nth-child(5) { top: 50%; left: 50%; animation-delay: 4s; font-size: 42px; }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    /* Sound toggle */
    .sound-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.95);
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    
    .sound-toggle:hover { transform: scale(1.1); }
    
    /* Content */
    .content {
      position: relative;
      z-index: 1;
    }
    
    /* Screen - hidden by default */
    .screen { display: none; }
    .screen.active { display: block; }
    
    /* Home Screen */
    .home-screen { text-align: center; padding: 40px 20px; }
    
    .app-title {
      font-size: 2.8rem;
      font-weight: 800;
      color: white;
      text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
      margin-bottom: 10px;
      animation: bounceIn 0.8s ease;
    }
    
    .app-subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      margin-bottom: 40px;
    }
    
    .mascot {
      font-size: 120px;
      margin: 30px 0;
      animation: bounce 2s ease infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.5); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .menu-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 300px;
      margin: 0 auto;
    }
    
    .menu-btn {
      padding: 18px 30px;
      font-size: 1.3rem;
      font-weight: 700;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    
    .menu-btn.play {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b;
      box-shadow: 0 6px 0 #d4904a, 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .menu-btn.verbs {
      background: linear-gradient(135deg, #a8e6cf 0%, #88d8b0 100%);
      color: #2d6a4f;
      box-shadow: 0 6px 0 #5fa87f, 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .menu-btn.learn {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #4a6572;
      box-shadow: 0 6px 0 #7fb8b6, 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .menu-btn:hover { transform: translateY(-3px); }
    .menu-btn:active { transform: translateY(3px); }
    
    /* Game Header */
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 15px 25px;
      margin-bottom: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .back-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      transition: all 0.2s;
    }
    
    .back-btn:hover { background: #ee5a5a; transform: scale(1.05); }
    
    .progress-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .question-counter {
      font-weight: 700;
      color: #4a4a4a;
      font-size: 1.1rem;
    }
    
    .score-display {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
    }
    
    .streak-display {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
    }
    
    /* Progress bar */
    .progress-bar-container {
      background: rgba(255,255,255,0.3);
      border-radius: 10px;
      height: 10px;
      margin-bottom: 25px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #f6d365 0%, #fda085 100%);
      border-radius: 10px;
      transition: width 0.5s ease;
    }
    
    /* Question Card */
    .question-card {
      background: rgba(255,255,255,0.98);
      border-radius: 30px;
      padding: 35px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      animation: slideUp 0.5s ease;
    }
    
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .question-type-badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 20px;
      border-radius: 25px;
      font-weight: 700;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }
    
    .question-text {
      font-size: 1.6rem;
      color: #2d3748;
      margin-bottom: 25px;
      line-height: 1.4;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }
    
    .options-grid.vertical { grid-template-columns: 1fr; }
    
    .option-btn {
      padding: 18px 25px;
      font-size: 1.2rem;
      font-weight: 600;
      border: 3px solid #e2e8f0;
      border-radius: 20px;
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Nunito', sans-serif;
    }
    
    .option-btn:hover:not(:disabled) {
      border-color: #667eea;
      background: #f7fafc;
      transform: scale(1.02);
    }
    
    .option-btn.correct {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      border-color: #48bb78;
      animation: correctPulse 0.5s ease;
    }
    
    .option-btn.wrong {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      border-color: #fc8181;
      animation: shake 0.5s ease;
    }
    
    @keyframes correctPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .explanation {
      margin-top: 25px;
      padding: 20px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 1.1rem;
      animation: fadeIn 0.3s ease;
    }
    
    .explanation.correct {
      background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
      color: #276749;
    }
    
    .explanation.wrong {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      color: #c53030;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .next-btn {
      display: block;
      width: 100%;
      margin-top: 25px;
      padding: 18px;
      font-size: 1.3rem;
      font-weight: 700;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .next-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
    }
    
    /* Fill input */
    .hint-box {
      background: linear-gradient(135deg, #fff9c4 0%, #ffecd2 100%);
      padding: 15px 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      font-weight: 600;
      color: #8b6914;
    }
    
    .fill-input-container {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .fill-input {
      flex: 1;
      min-width: 200px;
      padding: 18px 25px;
      font-size: 1.3rem;
      border: 3px solid #e2e8f0;
      border-radius: 20px;
      font-family: 'Nunito', sans-serif;
      transition: all 0.2s;
    }
    
    .fill-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
    }
    
    .submit-btn {
      padding: 18px 35px;
      font-size: 1.2rem;
      font-weight: 700;
      border: none;
      border-radius: 20px;
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      transition: all 0.2s;
    }
    
    .submit-btn:hover { transform: scale(1.05); }
    
    /* Sort game */
    .sort-hint {
      color: #718096;
      font-size: 0.95rem;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .words-pool {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      min-height: 60px;
      padding: 15px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 20px;
      margin-bottom: 20px;
    }
    
    .draggable-word {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    
    .draggable-word:hover { transform: scale(1.1); }
    .draggable-word.selected {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b;
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .sort-containers {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .sort-box {
      background: white;
      border: 4px dashed #cbd5e0;
      border-radius: 20px;
      padding: 15px;
      min-height: 150px;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .sort-box:hover, .sort-box.active {
      border-color: #667eea;
      background: #f7fafc;
    }
    
    .sort-box h3 {
      font-size: 1rem;
      margin-bottom: 15px;
      color: #4a5568;
    }
    
    .sort-box.present h3 { color: #38a169; }
    .sort-box.past h3 { color: #dd6b20; }
    
    .sorted-words {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .sorted-word {
      background: #e2e8f0;
      padding: 8px 15px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .sorted-word.correct { background: #c6f6d5; color: #276749; }
    .sorted-word.wrong { background: #fed7d7; color: #c53030; }
    
    /* True/False */
    .tf-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    .tf-btn {
      padding: 25px;
      font-size: 1.4rem;
      font-weight: 700;
      border: 4px solid transparent;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Nunito', sans-serif;
    }
    
    .tf-btn.true {
      background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
      color: #276749;
    }
    
    .tf-btn.false {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      color: #c53030;
    }
    
    .tf-btn:hover:not(:disabled) { transform: scale(1.05); }
    .tf-btn.correct { border-color: #48bb78; }
    .tf-btn.wrong { border-color: #fc8181; }
    
    /* Picture */
    .picture-emoji {
      font-size: 80px;
      text-align: center;
      margin-bottom: 20px;
      animation: bounce 2s ease infinite;
    }
    
    /* Result */
    .result-screen { text-align: center; padding: 40px 20px; }
    
    .result-card {
      background: rgba(255,255,255,0.98);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      animation: bounceIn 0.8s ease;
    }
    
    .result-title {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .result-emoji { font-size: 100px; margin: 20px 0; }
    .stars-display { font-size: 60px; margin: 20px 0; }
    .result-score { font-size: 1.5rem; color: #4a5568; margin-bottom: 10px; }
    .result-message { font-size: 1.2rem; color: #718096; margin-bottom: 30px; }
    
    .result-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    /* Lesson Screen */
    .lesson-card {
      background: rgba(255,255,255,0.98);
      border-radius: 30px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .lesson-title {
      font-size: 1.8rem;
      font-weight: 800;
      color: #2d3748;
      margin-bottom: 20px;
    }
    
    .tense-box {
      background: linear-gradient(135deg, #f6f9fc 0%, #edf2f7 100%);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .tense-box h3 {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    
    .tense-box.present h3 { color: #38a169; }
    .tense-box.past h3 { color: #dd6b20; }
    
    .signal-words {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .signal-word {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9rem;
    }
    
    .signal-word.present { background: #c6f6d5; color: #276749; }
    .signal-word.past { background: #feebc8; color: #c05621; }
    
    .examples {
      background: white;
      border-radius: 15px;
      padding: 15px 20px;
    }
    
    .example-sentence {
      padding: 8px 0;
      border-bottom: 1px solid #edf2f7;
      color: #4a5568;
    }
    
    .example-sentence:last-child { border-bottom: none; }
    
    .irregular-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .irregular-table th, .irregular-table td {
      padding: 12px;
      text-align: center;
      border-bottom: 2px solid #edf2f7;
    }
    
    .irregular-table th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 700;
    }
    
    .irregular-table tr:hover td { background: #f7fafc; }
    
    /* Verb Learning */
    .verb-menu { text-align: center; }
    
    .verb-title {
      font-size: 2rem;
      font-weight: 800;
      color: white;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
      margin-bottom: 10px;
    }
    
    .verb-subtitle {
      color: rgba(255,255,255,0.9);
      font-size: 1.1rem;
      margin-bottom: 25px;
    }
    
    .verb-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .verb-stats span {
      background: rgba(255,255,255,0.2);
      padding: 10px 20px;
      border-radius: 25px;
      color: white;
      font-weight: 600;
    }
    
    .verb-mode-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .verb-mode-btn {
      background: white;
      border: none;
      border-radius: 20px;
      padding: 25px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .verb-mode-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.2);
    }
    
    .verb-mode-btn .mode-icon { font-size: 2.5rem; }
    .verb-mode-btn .mode-name { font-size: 1.2rem; font-weight: 700; color: #2d3748; }
    .verb-mode-btn .mode-desc { font-size: 0.85rem; color: #718096; }
    
    .verb-mode-btn.flashcard { border-bottom: 4px solid #667eea; }
    .verb-mode-btn.match { border-bottom: 4px solid #f093fb; }
    .verb-mode-btn.fill { border-bottom: 4px solid #f6d365; }
    .verb-mode-btn.test { border-bottom: 4px solid #84fab0; }
    
    /* Flashcard */
    .flashcard-mode { max-width: 500px; margin: 0 auto; }
    
    .flashcard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .flashcard-progress {
      background: rgba(255,255,255,0.9);
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 700;
      color: #4a5568;
    }
    
    .flashcard {
      perspective: 1000px;
      cursor: pointer;
      margin-bottom: 30px;
    }
    
    .flashcard-inner {
      position: relative;
      width: 100%;
      height: 280px;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
    
    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    .flashcard-front {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .flashcard-back {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      color: #2d3748;
      transform: rotateY(180deg);
    }
    
    .flashcard-label { font-size: 1rem; font-weight: 600; opacity: 0.8; margin-bottom: 15px; }
    .flashcard-word { font-size: 3.5rem; font-weight: 800; margin-bottom: 20px; }
    .flashcard-hint { font-size: 0.9rem; opacity: 0.7; }
    .flashcard-pair {
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 10px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.5);
      border-radius: 15px;
    }
    
    .flashcard-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    .flashcard-btn {
      padding: 15px 25px;
      border: none;
      border-radius: 15px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Nunito', sans-serif;
    }
    
    .flashcard-btn.prev, .flashcard-btn.next { background: white; color: #4a5568; }
    .flashcard-btn.shuffle {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b;
    }
    .flashcard-btn:hover { transform: scale(1.05); }
    
    /* Match game */
    .match-mode { max-width: 600px; margin: 0 auto; }
    
    .match-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .match-score {
      background: rgba(255,255,255,0.9);
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 700;
      color: #4a5568;
    }
    
    .match-title {
      text-align: center;
      color: white;
      font-size: 1.3rem;
      margin-bottom: 25px;
    }
    
    .match-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 25px;
    }
    
    .match-card {
      padding: 20px 15px;
      border: none;
      border-radius: 15px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Nunito', sans-serif;
    }
    
    .match-card.base {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .match-card.past {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #5a3e2b;
    }
    
    .match-card.selected {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    .match-card.matched {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      color: #276749;
      opacity: 0.7;
      cursor: default;
    }
    
    .match-card:hover:not(.matched) { transform: scale(1.05); }
    
    .match-complete {
      text-align: center;
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 20px;
    }
    
    .match-complete p {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 20px;
    }
    
    /* Verb fill */
    .verb-fill-mode { max-width: 500px; margin: 0 auto; }
    
    .verb-fill-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .verb-fill-progress, .verb-fill-score {
      background: rgba(255,255,255,0.9);
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 700;
      color: #4a5568;
    }
    
    .verb-fill-card {
      background: rgba(255,255,255,0.98);
      border-radius: 25px;
      padding: 35px;
      text-align: center;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    
    .verb-fill-card h3 {
      font-size: 1.3rem;
      color: #4a5568;
      margin-bottom: 20px;
    }
    
    .verb-fill-word {
      font-size: 3.5rem;
      font-weight: 800;
      color: #667eea;
      margin-bottom: 30px;
    }
    
    .verb-fill-input {
      width: 100%;
      max-width: 300px;
      padding: 18px 25px;
      font-size: 1.5rem;
      text-align: center;
      border: 3px solid #e2e8f0;
      border-radius: 20px;
      font-family: 'Nunito', sans-serif;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .verb-fill-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .verb-fill-result {
      margin-top: 25px;
      padding: 20px;
      border-radius: 15px;
    }
    
    .verb-fill-result.correct {
      background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
    }
    
    .verb-fill-result.wrong {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    }
    
    .verb-fill-result p {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #2d3748;
    }
    
    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
    
    .confetti {
      position: absolute;
      width: 15px;
      height: 15px;
      animation: confettiFall 3s linear forwards;
    }
    
    @keyframes confettiFall {
      0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      .app-title { font-size: 2rem; }
      .question-text { font-size: 1.3rem; }
      .sort-containers { grid-template-columns: 1fr; }
      .tf-buttons { grid-template-columns: 1fr; }
      .match-grid { grid-template-columns: repeat(3, 1fr); }
      .question-card { padding: 20px; }
      .verb-fill-word { font-size: 2.5rem; }
      .flashcard-word { font-size: 2.5rem; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="floating-shapes">
      <span class="shape">üìö</span>
      <span class="shape">‚ú®</span>
      <span class="shape">üåü</span>
      <span class="shape">üéØ</span>
      <span class="shape">üèÜ</span>
    </div>
    
    <button class="sound-toggle" onclick="toggleSound()" title="B·∫≠t/T·∫Øt √¢m thanh">üîä</button>
    
    <div id="confetti-container" class="confetti-container"></div>
    
    <div class="content">
      <!-- HOME SCREEN -->
      <div id="home-screen" class="screen active">
        <div class="home-screen">
          <h1 class="app-title">üåà English Tenses</h1>
          <p class="app-subtitle">H·ªçc ph√¢n bi·ªát th√¨ Hi·ªán t·∫°i & Qu√° kh·ª©</p>
          <div class="mascot">ü¶â</div>
          <div class="menu-buttons">
            <button class="menu-btn play" onclick="startGame()">üéÆ Ch∆°i ngay!</button>
            <button class="menu-btn verbs" onclick="showVerbMenu()">üîÑ H·ªçc ƒë·ªông t·ª´ BQT</button>
            <button class="menu-btn learn" onclick="showLesson()">üìñ H·ªçc b√†i</button>
          </div>
        </div>
      </div>
      
      <!-- GAME SCREEN -->
      <div id="game-screen" class="screen"></div>
      
      <!-- RESULT SCREEN -->
      <div id="result-screen" class="screen"></div>
      
      <!-- LESSON SCREEN -->
      <div id="lesson-screen" class="screen"></div>
      
      <!-- VERB SCREEN -->
      <div id="verb-screen" class="screen"></div>
    </div>
  </div>

  <script>
    // ==================== DATA ====================
    const QUESTIONS = {
      multiple: [
        { question: 'I ___ to school every day.', options: ['go', 'went', 'going'], correct: 0, explanation: '"Every day" = m·ªói ng√†y ‚Üí th√¨ hi·ªán t·∫°i "go"' },
        { question: 'She ___ a book yesterday.', options: ['reads', 'read', 'reading'], correct: 1, explanation: '"Yesterday" = h√¥m qua ‚Üí th√¨ qu√° kh·ª© "read"' },
        { question: 'They ___ football last Sunday.', options: ['play', 'played', 'plays'], correct: 1, explanation: '"Last Sunday" = Ch·ªß nh·∫≠t tu·∫ßn tr∆∞·ªõc ‚Üí qu√° kh·ª© "played"' },
        { question: 'My cat ___ milk every morning.', options: ['drinks', 'drank', 'drinking'], correct: 0, explanation: '"Every morning" = m·ªói s√°ng ‚Üí hi·ªán t·∫°i "drinks"' },
        { question: 'We ___ a movie last night.', options: ['watch', 'watched', 'watches'], correct: 1, explanation: '"Last night" = t·ªëi qua ‚Üí qu√° kh·ª© "watched"' },
        { question: 'He ___ his homework every day.', options: ['did', 'does', 'doing'], correct: 1, explanation: '"Every day" = m·ªói ng√†y ‚Üí hi·ªán t·∫°i "does"' },
        { question: 'I ___ my grandma last weekend.', options: ['visit', 'visited', 'visits'], correct: 1, explanation: '"Last weekend" = cu·ªëi tu·∫ßn tr∆∞·ªõc ‚Üí qu√° kh·ª© "visited"' },
        { question: 'Birds ___ in the sky.', options: ['fly', 'flew', 'flying'], correct: 0, explanation: 'S·ª± th·∫≠t hi·ªÉn nhi√™n ‚Üí hi·ªán t·∫°i "fly"' },
        { question: 'She ___ a cake yesterday.', options: ['makes', 'make', 'made'], correct: 2, explanation: '"Yesterday" = h√¥m qua ‚Üí qu√° kh·ª© "made"' },
        { question: 'I always ___ breakfast at 7 AM.', options: ['eat', 'ate', 'eats'], correct: 0, explanation: '"Always" = lu√¥n lu√¥n ‚Üí hi·ªán t·∫°i "eat"' },
        { question: 'We ___ to the zoo last month.', options: ['go', 'went', 'goes'], correct: 1, explanation: '"Last month" = th√°ng tr∆∞·ªõc ‚Üí qu√° kh·ª© "went"' },
        { question: 'The sun ___ in the East.', options: ['rise', 'rises', 'rose'], correct: 1, explanation: 'S·ª± th·∫≠t t·ª± nhi√™n ‚Üí hi·ªán t·∫°i "rises"' },
        { question: 'I ___ a sandwich two hours ago.', options: ['eat', 'ate', 'eats'], correct: 1, explanation: '"Ago" = tr∆∞·ªõc ƒë√¢y ‚Üí qu√° kh·ª© "ate"' },
        { question: 'She usually ___ to bed early.', options: ['go', 'goes', 'went'], correct: 1, explanation: '"Usually" = th∆∞·ªùng th∆∞·ªùng ‚Üí hi·ªán t·∫°i "goes"' },
        { question: 'Mom ___ us a story yesterday.', options: ['tell', 'told', 'tells'], correct: 1, explanation: '"Yesterday" ‚Üí qu√° kh·ª© "told"' },
      ],
      fill: [
        { sentence: 'They ___ (play) games yesterday.', answer: 'played', hint: '"Yesterday" = h√¥m qua! Th√™m -ed' },
        { sentence: 'She ___ (go) to school every day.', answer: 'goes', hint: '"Every day"! she ‚Üí goes' },
        { sentence: 'I ___ (eat) breakfast this morning.', answer: 'ate', hint: '"This morning" ƒë√£ qua! eat ‚Üí ate' },
        { sentence: 'My dog ___ (like) bones.', answer: 'likes', hint: 'S·ª± th·∫≠t lu√¥n ƒë√∫ng! Th√™m -s' },
        { sentence: 'We ___ (see) a rainbow last week.', answer: 'saw', hint: '"Last week"! see ‚Üí saw' },
        { sentence: 'He ___ (drink) water every day.', answer: 'drinks', hint: '"Every day"! he ‚Üí drinks' },
        { sentence: 'She ___ (watch) TV last night.', answer: 'watched', hint: '"Last night"! Th√™m -ed' },
        { sentence: 'I ___ (have) a good dream last night.', answer: 'had', hint: '"Last night"! have ‚Üí had' },
        { sentence: 'Mom ___ (cook) dinner every day.', answer: 'cooks', hint: '"Every day"! Th√™m -s' },
        { sentence: 'We ___ (take) many photos last holiday.', answer: 'took', hint: '"Last holiday"! take ‚Üí took' },
      ],
      truefalse: [
        { statement: '"Yesterday" d√πng v·ªõi th√¨ qu√° kh·ª©', correct: true, explanation: 'ƒê√∫ng r·ªìi! "Yesterday" = h√¥m qua ‚Üí lu√¥n d√πng qu√° kh·ª©' },
        { statement: '"Every day" d√πng v·ªõi th√¨ qu√° kh·ª©', correct: false, explanation: 'Sai r·ªìi! "Every day" = m·ªói ng√†y ‚Üí d√πng hi·ªán t·∫°i' },
        { statement: '"Played" l√† d·∫°ng qu√° kh·ª© c·ªßa "play"', correct: true, explanation: 'ƒê√∫ng! Th√™m -ed v√†o cu·ªëi ‚Üí played' },
        { statement: '"Go - went" l√† ƒë·ªông t·ª´ b·∫•t quy t·∫Øc', correct: true, explanation: 'ƒê√∫ng! Go kh√¥ng th√™m -ed m√† ƒë·ªïi th√†nh went' },
        { statement: 'Th√™m -ed v√†o "eat" th√†nh "eated"', correct: false, explanation: 'Sai! "Eat" l√† ƒë·ªông t·ª´ b·∫•t quy t·∫Øc ‚Üí "ate"' },
        { statement: '"Always" d√πng v·ªõi th√¨ hi·ªán t·∫°i', correct: true, explanation: 'ƒê√∫ng! "Always" = lu√¥n lu√¥n ‚Üí hi·ªán t·∫°i' },
        { statement: '"Last night" d√πng v·ªõi th√¨ hi·ªán t·∫°i', correct: false, explanation: 'Sai! "Last night" = t·ªëi qua ‚Üí qu√° kh·ª©' },
        { statement: 'Qu√° kh·ª© c·ªßa "have" l√† "haved"', correct: false, explanation: 'Sai! "Have" l√† ƒë·ªông t·ª´ b·∫•t quy t·∫Øc ‚Üí "had"' },
      ],
      picture: [
        { image: 'üåÖ', question: 'Ch·ªçn c√¢u ƒë√∫ng:', options: ['The sun rises every day.', 'The sun rised yesterday.'], correct: 0, explanation: 'M·∫∑t tr·ªùi m·ªçc m·ªói ng√†y ‚Üí s·ª± th·∫≠t ‚Üí hi·ªán t·∫°i!' },
        { image: 'üéÇ', question: 'H√¥m qua l√† sinh nh·∫≠t Tom:', options: ['Tom has a party.', 'Tom had a party.'], correct: 1, explanation: '"H√¥m qua" ‚Üí qu√° kh·ª© ‚Üí had!' },
        { image: 'üìö', question: 'Lisa ƒë·ªçc s√°ch m·ªói t·ªëi:', options: ['Lisa reads books every night.', 'Lisa read books every night.'], correct: 0, explanation: '"M·ªói t·ªëi" ‚Üí th√≥i quen ‚Üí hi·ªán t·∫°i!' },
        { image: 'üèä', question: 'Tu·∫ßn tr∆∞·ªõc Tom ƒëi b∆°i:', options: ['Tom swims last week.', 'Tom swam last week.'], correct: 1, explanation: '"Last week" ‚Üí qu√° kh·ª©!' },
        { image: 'üçé', question: 'Mary ƒÉn t√°o m·ªói ng√†y:', options: ['Mary eats an apple every day.', 'Mary ate an apple every day.'], correct: 0, explanation: '"Every day" ‚Üí th√≥i quen ‚Üí hi·ªán t·∫°i!' },
        { image: 'üéÅ', question: 'H√¥m qua m·∫π t·∫∑ng qu√†:', options: ['Mom gives a gift yesterday.', 'Mom gave a gift yesterday.'], correct: 1, explanation: '"Yesterday" ‚Üí qu√° kh·ª©!' },
      ],
      sort: [
        { instruction: 'K√©o c√°c t·ª´ th·ªùi gian v√†o ƒë√∫ng c·ªôt!', words: ['yesterday', 'every day', 'last week', 'always', 'ago', 'now'], presentWords: ['every day', 'always', 'now'], pastWords: ['yesterday', 'last week', 'ago'] },
        { instruction: 'Ph√¢n lo·∫°i c√°c ƒë·ªông t·ª´!', words: ['played', 'eat', 'went', 'like', 'watched', 'run'], presentWords: ['eat', 'like', 'run'], pastWords: ['played', 'went', 'watched'] },
        { instruction: 'K√©o t·ª´ v√†o ƒë√∫ng th√¨!', words: ['usually', 'last year', 'often', 'two days ago', 'sometimes', 'last Monday'], presentWords: ['usually', 'often', 'sometimes'], pastWords: ['last year', 'two days ago', 'last Monday'] },
      ]
    };

    const IRREGULAR_VERBS = [
      { base: 'go', past: 'went' }, { base: 'eat', past: 'ate' }, { base: 'see', past: 'saw' },
      { base: 'have', past: 'had' }, { base: 'come', past: 'came' }, { base: 'make', past: 'made' },
      { base: 'take', past: 'took' }, { base: 'get', past: 'got' }, { base: 'run', past: 'ran' },
      { base: 'swim', past: 'swam' }, { base: 'drink', past: 'drank' }, { base: 'sing', past: 'sang' },
      { base: 'write', past: 'wrote' }, { base: 'read', past: 'read' }, { base: 'give', past: 'gave' },
      { base: 'find', past: 'found' }, { base: 'tell', past: 'told' }, { base: 'say', past: 'said' },
      { base: 'buy', past: 'bought' }, { base: 'bring', past: 'brought' }, { base: 'think', past: 'thought' },
      { base: 'catch', past: 'caught' }, { base: 'teach', past: 'taught' }, { base: 'sit', past: 'sat' },
      { base: 'sleep', past: 'slept' }, { base: 'keep', past: 'kept' }, { base: 'leave', past: 'left' },
      { base: 'lose', past: 'lost' }, { base: 'drive', past: 'drove' }, { base: 'fly', past: 'flew' },
      { base: 'know', past: 'knew' }, { base: 'grow', past: 'grew' }, { base: 'throw', past: 'threw' },
      { base: 'begin', past: 'began' }, { base: 'break', past: 'broke' }, { base: 'speak', past: 'spoke' },
      { base: 'wear', past: 'wore' }, { base: 'choose', past: 'chose' }, { base: 'ride', past: 'rode' },
      { base: 'stand', past: 'stood' }
    ];

    const TIME_SIGNALS = {
      present: ['every day', 'always', 'usually', 'sometimes', 'often', 'now', 'every week', 'every morning'],
      past: ['yesterday', 'last week', 'last night', 'ago', 'last year', 'last Sunday', 'last month']
    };

    // ==================== STATE ====================
    let soundEnabled = true;
    let currentScreen = 'home';
    let gameQuestions = [];
    let currentQuestion = 0;
    let score = 0;
    let streak = 0;
    let selectedAnswer = null;
    let isAnswered = false;
    
    // Sort game state
    let sortedPresent = [];
    let sortedPast = [];
    let remainingWords = [];
    let selectedWord = null;
    
    // Verb learning state
    let verbMode = 'menu';
    let shuffledVerbs = [];
    let currentVerbIndex = 0;
    let showVerbAnswer = false;
    let verbScore = 0;
    let verbTotal = 0;
    let matchPairs = [];
    let selectedMatch = null;
    let matchedPairs = [];
    let testVerbs = [];
    let testIndex = 0;

    // ==================== SOUND ====================
    function playSound(type) {
      if (!soundEnabled) return;
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        switch(type) {
          case 'correct':
            osc.frequency.setValueAtTime(523.25, ctx.currentTime);
            osc.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1);
            osc.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.4);
            break;
          case 'wrong':
            osc.frequency.setValueAtTime(311.13, ctx.currentTime);
            osc.frequency.setValueAtTime(277.18, ctx.currentTime + 0.15);
            gain.gain.setValueAtTime(0.2, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.3);
            break;
          case 'click':
            osc.frequency.setValueAtTime(800, ctx.currentTime);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.05);
            break;
          case 'flip':
            osc.frequency.setValueAtTime(600, ctx.currentTime);
            osc.frequency.setValueAtTime(900, ctx.currentTime + 0.05);
            gain.gain.setValueAtTime(0.15, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.1);
            break;
          case 'complete':
            [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
              const o = ctx.createOscillator();
              const g = ctx.createGain();
              o.connect(g); g.connect(ctx.destination);
              o.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
              g.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
              g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.2);
              o.start(ctx.currentTime + i * 0.15);
              o.stop(ctx.currentTime + i * 0.15 + 0.2);
            });
            break;
          case 'match':
            osc.frequency.setValueAtTime(440, ctx.currentTime);
            osc.frequency.setValueAtTime(554.37, ctx.currentTime + 0.08);
            osc.frequency.setValueAtTime(659.25, ctx.currentTime + 0.16);
            gain.gain.setValueAtTime(0.25, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.3);
            break;
        }
      } catch(e) {}
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      document.querySelector('.sound-toggle').textContent = soundEnabled ? 'üîä' : 'üîá';
      playSound('click');
    }

    // ==================== CONFETTI ====================
    function showConfetti() {
      const container = document.getElementById('confetti-container');
      container.innerHTML = '';
      const colors = ['#f6d365', '#fda085', '#667eea', '#764ba2', '#84fab0'];
      for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(confetti);
      }
      setTimeout(() => container.innerHTML = '', 3000);
    }

    // ==================== NAVIGATION ====================
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
      currentScreen = screenId;
    }

    function goHome() {
      showScreen('home-screen');
    }

    // ==================== GAME ====================
    function startGame() {
      // Build questions
      const allQuestions = [];
      QUESTIONS.multiple.forEach(q => allQuestions.push({...q, type: 'multiple'}));
      QUESTIONS.fill.forEach(q => allQuestions.push({...q, type: 'fill'}));
      QUESTIONS.truefalse.forEach(q => allQuestions.push({...q, type: 'truefalse'}));
      QUESTIONS.picture.forEach(q => allQuestions.push({...q, type: 'picture'}));
      QUESTIONS.sort.forEach(q => allQuestions.push({...q, type: 'sort'}));
      
      // Shuffle and pick 10
      gameQuestions = allQuestions.sort(() => Math.random() - 0.5).slice(0, 10);
      currentQuestion = 0;
      score = 0;
      streak = 0;
      
      showScreen('game-screen');
      renderQuestion();
    }

    function renderQuestion() {
      const q = gameQuestions[currentQuestion];
      let html = `
        <div class="game-header">
          <button class="back-btn" onclick="goHome()">‚Üê V·ªÅ</button>
          <div class="progress-info">
            <span class="question-counter">C√¢u ${currentQuestion + 1}/${gameQuestions.length}</span>
            <span class="score-display">‚≠ê ${score}</span>
            ${streak >= 2 ? `<span class="streak-display">üî• ${streak}</span>` : ''}
          </div>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: ${((currentQuestion + 1) / gameQuestions.length) * 100}%"></div>
        </div>
      `;
      
      html += '<div class="question-card">';
      
      switch(q.type) {
        case 'multiple':
          html += `
            <div class="question-type-badge">üéØ Ch·ªçn ƒë√°p √°n ƒë√∫ng</div>
            <h2 class="question-text">${q.question}</h2>
            <div class="options-grid">
              ${q.options.map((opt, i) => `
                <button class="option-btn" onclick="handleMultipleAnswer(${i})" id="opt-${i}">${opt}</button>
              `).join('')}
            </div>
            <div id="explanation"></div>
          `;
          break;
          
        case 'fill':
          html += `
            <div class="question-type-badge">‚úèÔ∏è ƒêi·ªÅn v√†o ch·ªó tr·ªëng</div>
            <h2 class="question-text">${q.sentence}</h2>
            <div class="hint-box">üí° G·ª£i √Ω: ${q.hint}</div>
            <div class="fill-input-container">
              <input type="text" class="fill-input" id="fill-input" placeholder="Nh·∫≠p ƒë√°p √°n..." onkeypress="if(event.key==='Enter')handleFillAnswer()">
              <button class="submit-btn" onclick="handleFillAnswer()" id="fill-submit">Ki·ªÉm tra</button>
            </div>
            <div id="explanation"></div>
          `;
          break;
          
        case 'truefalse':
          html += `
            <div class="question-type-badge">‚úÖ ƒê√∫ng hay Sai?</div>
            <h2 class="question-text">${q.statement}</h2>
            <div class="tf-buttons">
              <button class="tf-btn true" onclick="handleTFAnswer(true)" id="tf-true">‚úì ƒê√∫ng</button>
              <button class="tf-btn false" onclick="handleTFAnswer(false)" id="tf-false">‚úó Sai</button>
            </div>
            <div id="explanation"></div>
          `;
          break;
          
        case 'picture':
          html += `
            <div class="question-type-badge">üñºÔ∏è Nh√¨n h√¨nh ch·ªçn c√¢u</div>
            <div class="picture-emoji">${q.image}</div>
            <h2 class="question-text">${q.question}</h2>
            <div class="options-grid vertical">
              ${q.options.map((opt, i) => `
                <button class="option-btn" onclick="handleMultipleAnswer(${i})" id="opt-${i}">${opt}</button>
              `).join('')}
            </div>
            <div id="explanation"></div>
          `;
          break;
          
        case 'sort':
          remainingWords = [...q.words].sort(() => Math.random() - 0.5);
          sortedPresent = [];
          sortedPast = [];
          selectedWord = null;
          html += `
            <div class="question-type-badge">üéÆ Ph√¢n lo·∫°i t·ª´</div>
            <h2 class="question-text">${q.instruction}</h2>
            <p class="sort-hint">üëÜ Ch·∫°m v√†o t·ª´, r·ªìi ch·∫°m v√†o √¥ ƒë·ªÉ ph√¢n lo·∫°i!</p>
            <div class="words-pool" id="words-pool"></div>
            <div class="sort-containers">
              <div class="sort-box present" onclick="dropWord('present')">
                <h3>üåü Hi·ªán t·∫°i (Present)</h3>
                <div class="sorted-words" id="present-words"></div>
              </div>
              <div class="sort-box past" onclick="dropWord('past')">
                <h3>‚è∞ Qu√° kh·ª© (Past)</h3>
                <div class="sorted-words" id="past-words"></div>
              </div>
            </div>
            <button class="submit-btn" onclick="checkSortAnswer()" id="sort-submit" style="display:none;width:100%">Ki·ªÉm tra</button>
            <div id="explanation"></div>
          `;
          break;
      }
      
      html += '</div>';
      document.getElementById('game-screen').innerHTML = html;
      
      if (q.type === 'sort') renderSortWords();
    }

    function renderSortWords() {
      const pool = document.getElementById('words-pool');
      pool.innerHTML = remainingWords.map(w => `
        <div class="draggable-word ${selectedWord === w ? 'selected' : ''}" onclick="selectWord('${w}')">${w}</div>
      `).join('');
      
      document.getElementById('present-words').innerHTML = sortedPresent.map(w => `<span class="sorted-word">${w}</span>`).join('');
      document.getElementById('past-words').innerHTML = sortedPast.map(w => `<span class="sorted-word">${w}</span>`).join('');
      
      document.getElementById('sort-submit').style.display = remainingWords.length === 0 ? 'block' : 'none';
    }

    function selectWord(word) {
      playSound('click');
      selectedWord = selectedWord === word ? null : word;
      renderSortWords();
    }

    function dropWord(target) {
      if (!selectedWord) return;
      playSound('click');
      if (target === 'present') {
        sortedPresent.push(selectedWord);
      } else {
        sortedPast.push(selectedWord);
      }
      remainingWords = remainingWords.filter(w => w !== selectedWord);
      selectedWord = null;
      renderSortWords();
    }

    function handleMultipleAnswer(index) {
      const q = gameQuestions[currentQuestion];
      const correct = index === q.correct;
      
      document.querySelectorAll('.option-btn').forEach((btn, i) => {
        btn.disabled = true;
        if (i === q.correct) btn.classList.add('correct');
        if (i === index && !correct) btn.classList.add('wrong');
      });
      
      showAnswerResult(correct, q.explanation);
    }

    function handleFillAnswer() {
      const q = gameQuestions[currentQuestion];
      const input = document.getElementById('fill-input');
      const correct = input.value.toLowerCase().trim() === q.answer.toLowerCase();
      
      input.disabled = true;
      document.getElementById('fill-submit').style.display = 'none';
      
      showAnswerResult(correct, correct ? 'üéâ Tuy·ªát v·ªùi!' : `üí° ƒê√°p √°n ƒë√∫ng: ${q.answer}`);
    }

    function handleTFAnswer(answer) {
      const q = gameQuestions[currentQuestion];
      const correct = answer === q.correct;
      
      document.getElementById('tf-true').disabled = true;
      document.getElementById('tf-false').disabled = true;
      
      if (q.correct === true) document.getElementById('tf-true').classList.add('correct');
      else document.getElementById('tf-false').classList.add('correct');
      
      if (!correct) {
        document.getElementById(answer ? 'tf-true' : 'tf-false').classList.add('wrong');
      }
      
      showAnswerResult(correct, q.explanation);
    }

    function checkSortAnswer() {
      const q = gameQuestions[currentQuestion];
      const presentCorrect = sortedPresent.every(w => q.presentWords.includes(w)) && sortedPresent.length === q.presentWords.length;
      const pastCorrect = sortedPast.every(w => q.pastWords.includes(w)) && sortedPast.length === q.pastWords.length;
      const correct = presentCorrect && pastCorrect;
      
      // Show correct/wrong colors
      document.getElementById('present-words').innerHTML = sortedPresent.map(w => 
        `<span class="sorted-word ${q.presentWords.includes(w) ? 'correct' : 'wrong'}">${w}</span>`
      ).join('');
      document.getElementById('past-words').innerHTML = sortedPast.map(w => 
        `<span class="sorted-word ${q.pastWords.includes(w) ? 'correct' : 'wrong'}">${w}</span>`
      ).join('');
      
      document.getElementById('sort-submit').style.display = 'none';
      showAnswerResult(correct, correct ? 'üéâ Xu·∫•t s·∫Øc!' : 'üí° yesterday, last..., ago ‚Üí Qu√° kh·ª© | every..., always, now ‚Üí Hi·ªán t·∫°i');
    }

    function showAnswerResult(correct, explanation) {
      if (correct) {
        score++;
        streak++;
        playSound('correct');
        if (streak >= 3) showConfetti();
      } else {
        streak = 0;
        playSound('wrong');
      }
      
      document.getElementById('explanation').innerHTML = `
        <div class="explanation ${correct ? 'correct' : 'wrong'}">
          ${correct ? 'üéâ ' : 'üí° '}${explanation}
        </div>
        <button class="next-btn" onclick="nextQuestion()">
          ${currentQuestion < gameQuestions.length - 1 ? 'C√¢u ti·∫øp theo ‚Üí' : 'Xem k·∫øt qu·∫£ üèÜ'}
        </button>
      `;
    }

    function nextQuestion() {
      if (currentQuestion < gameQuestions.length - 1) {
        currentQuestion++;
        renderQuestion();
      } else {
        playSound('complete');
        showGameResult();
      }
    }

    function showGameResult() {
      const percentage = Math.round((score / gameQuestions.length) * 100);
      const stars = Math.min(3, Math.floor(percentage / 33));
      
      document.getElementById('result-screen').innerHTML = `
        <div class="result-screen">
          <div class="result-card">
            <h2 class="result-title">üéâ Ho√†n th√†nh!</h2>
            <div class="result-emoji">${percentage >= 80 ? 'üèÜ' : percentage >= 50 ? 'üåü' : 'üí™'}</div>
            <div class="stars-display">${'‚≠ê'.repeat(stars)}${'‚òÜ'.repeat(3-stars)}</div>
            <p class="result-score">ƒêi·ªÉm: <strong>${score}/${gameQuestions.length}</strong></p>
            <p class="result-message">
              ${percentage >= 80 ? 'Xu·∫•t s·∫Øc! Con gi·ªèi qu√°! üéä' : percentage >= 50 ? 'T·ªët l·∫Øm! C·ªë g·∫Øng th√™m nh√©! üí™' : 'C·∫ßn √¥n l·∫°i b√†i h·ªçc nha! üìö'}
            </p>
            <div class="result-buttons">
              <button class="menu-btn play" onclick="startGame()">üîÑ Ch∆°i l·∫°i</button>
              <button class="menu-btn learn" onclick="showLesson()">üìñ √în b√†i</button>
              <button class="menu-btn learn" onclick="goHome()">üè† V·ªÅ nh√†</button>
            </div>
          </div>
        </div>
      `;
      showScreen('result-screen');
    }

    // ==================== LESSON ====================
    function showLesson() {
      document.getElementById('lesson-screen').innerHTML = `
        <button class="back-btn" onclick="goHome()" style="margin-bottom:20px">‚Üê V·ªÅ trang ch·ªß</button>
        
        <div class="lesson-card">
          <h2 class="lesson-title">üìö B√†i h·ªçc: Ph√¢n bi·ªát Hi·ªán t·∫°i & Qu√° kh·ª©</h2>
          
          <div class="tense-box present">
            <h3>üåü Th√¨ Hi·ªán t·∫°i (Present Simple)</h3>
            <p style="margin-bottom:15px;color:#4a5568">D√πng khi n√≥i v·ªÅ <strong>th√≥i quen, s·ª± th·∫≠t, vi·ªác l·∫∑p ƒëi l·∫∑p l·∫°i</strong></p>
            <p style="margin-bottom:10px;font-weight:600">T·ª´ nh·∫≠n bi·∫øt:</p>
            <div class="signal-words">
              ${TIME_SIGNALS.present.map(w => `<span class="signal-word present">${w}</span>`).join('')}
            </div>
            <div class="examples">
              <p class="example-sentence">‚úì I <strong>go</strong> to school every day.</p>
              <p class="example-sentence">‚úì She <strong>likes</strong> ice cream.</p>
              <p class="example-sentence">‚úì The sun <strong>rises</strong> in the East.</p>
            </div>
          </div>
          
          <div class="tense-box past">
            <h3>‚è∞ Th√¨ Qu√° kh·ª© (Past Simple)</h3>
            <p style="margin-bottom:15px;color:#4a5568">D√πng khi n√≥i v·ªÅ <strong>vi·ªác ƒë√£ x·∫£y ra v√† k·∫øt th√∫c trong qu√° kh·ª©</strong></p>
            <p style="margin-bottom:10px;font-weight:600">T·ª´ nh·∫≠n bi·∫øt:</p>
            <div class="signal-words">
              ${TIME_SIGNALS.past.map(w => `<span class="signal-word past">${w}</span>`).join('')}
            </div>
            <div class="examples">
              <p class="example-sentence">‚úì I <strong>went</strong> to the park yesterday.</p>
              <p class="example-sentence">‚úì She <strong>watched</strong> TV last night.</p>
              <p class="example-sentence">‚úì They <strong>played</strong> football last Sunday.</p>
            </div>
          </div>
        </div>
        
        <div class="lesson-card">
          <h2 class="lesson-title">üîÑ ƒê·ªông t·ª´ b·∫•t quy t·∫Øc</h2>
          <p style="margin-bottom:15px;color:#718096">Nh·ªØng ƒë·ªông t·ª´ n√†y kh√¥ng th√™m -ed m√† ƒë·ªïi h·∫≥n sang d·∫°ng kh√°c</p>
          <table class="irregular-table">
            <thead><tr><th>Hi·ªán t·∫°i</th><th>Qu√° kh·ª©</th></tr></thead>
            <tbody>
              ${IRREGULAR_VERBS.slice(0, 20).map(v => `
                <tr><td style="font-weight:600;color:#38a169">${v.base}</td><td style="font-weight:600;color:#dd6b20">${v.past}</td></tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        
        <button class="menu-btn play" onclick="startGame()" style="width:100%">üéÆ Luy·ªán t·∫≠p ngay!</button>
      `;
      showScreen('lesson-screen');
    }

    // ==================== VERB LEARNING ====================
    function showVerbMenu() {
      shuffledVerbs = [...IRREGULAR_VERBS].sort(() => Math.random() - 0.5);
      currentVerbIndex = 0;
      verbMode = 'menu';
      renderVerbScreen();
      showScreen('verb-screen');
    }

    function renderVerbScreen() {
      let html = '';
      
      switch(verbMode) {
        case 'menu':
          html = `
            <div class="verb-menu">
              <h2 class="verb-title">üîÑ H·ªçc ƒê·ªông T·ª´ B·∫•t Quy T·∫Øc</h2>
              <p class="verb-subtitle">Ch·ªçn c√°ch h·ªçc ph√π h·ª£p v·ªõi con!</p>
              <div class="verb-stats"><span>üìö T·ªïng: ${IRREGULAR_VERBS.length} t·ª´</span></div>
              <div class="verb-mode-buttons">
                <button class="verb-mode-btn flashcard" onclick="startVerbMode('flashcard')">
                  <span class="mode-icon">üé¥</span>
                  <span class="mode-name">Flashcard</span>
                  <span class="mode-desc">L·∫≠t th·∫ª ghi nh·ªõ</span>
                </button>
                <button class="verb-mode-btn match" onclick="startVerbMode('match')">
                  <span class="mode-icon">üéØ</span>
                  <span class="mode-name">N·ªëi t·ª´</span>
                  <span class="mode-desc">Gh√©p ƒë√¥i ƒë√∫ng</span>
                </button>
                <button class="verb-mode-btn fill" onclick="startVerbMode('fill')">
                  <span class="mode-icon">‚úèÔ∏è</span>
                  <span class="mode-name">ƒêi·ªÅn t·ª´</span>
                  <span class="mode-desc">Vi·∫øt d·∫°ng qu√° kh·ª©</span>
                </button>
                <button class="verb-mode-btn test" onclick="startVerbMode('test')">
                  <span class="mode-icon">üìù</span>
                  <span class="mode-name">Ki·ªÉm tra</span>
                  <span class="mode-desc">10 c√¢u ng·∫´u nhi√™n</span>
                </button>
              </div>
              <button class="back-btn" onclick="goHome()" style="margin-top:30px">‚Üê V·ªÅ trang ch·ªß</button>
            </div>
          `;
          break;
          
        case 'flashcard':
          const v = shuffledVerbs[currentVerbIndex];
          html = `
            <div class="flashcard-mode">
              <div class="flashcard-header">
                <button class="back-btn" onclick="verbMode='menu';renderVerbScreen()">‚Üê V·ªÅ</button>
                <span class="flashcard-progress">${currentVerbIndex + 1} / ${shuffledVerbs.length}</span>
              </div>
              <div class="flashcard ${showVerbAnswer ? 'flipped' : ''}" onclick="flipCard()">
                <div class="flashcard-inner">
                  <div class="flashcard-front">
                    <span class="flashcard-label">Hi·ªán t·∫°i</span>
                    <span class="flashcard-word">${v.base}</span>
                    <span class="flashcard-hint">üëÜ Ch·∫°m ƒë·ªÉ l·∫≠t</span>
                  </div>
                  <div class="flashcard-back">
                    <span class="flashcard-label">Qu√° kh·ª©</span>
                    <span class="flashcard-word">${v.past}</span>
                    <span class="flashcard-pair">${v.base} ‚Üí ${v.past}</span>
                  </div>
                </div>
              </div>
              <div class="flashcard-buttons">
                <button class="flashcard-btn prev" onclick="prevCard()">‚Üê Tr∆∞·ªõc</button>
                <button class="flashcard-btn shuffle" onclick="shuffleCards()">üîÄ Tr·ªôn</button>
                <button class="flashcard-btn next" onclick="nextCard()">Sau ‚Üí</button>
              </div>
            </div>
          `;
          break;
          
        case 'match':
          html = `
            <div class="match-mode">
              <div class="match-header">
                <button class="back-btn" onclick="verbMode='menu';renderVerbScreen()">‚Üê V·ªÅ</button>
                <span class="match-score">‚úÖ ${matchedPairs.length} / 6</span>
              </div>
              <h3 class="match-title">üéØ N·ªëi t·ª´ hi·ªán t·∫°i v·ªõi qu√° kh·ª©!</h3>
              <div class="match-grid">
                ${matchPairs.map(card => `
                  <button class="match-card ${card.type} ${selectedMatch?.id === card.id ? 'selected' : ''} ${matchedPairs.includes(card.pairId) ? 'matched' : ''}"
                    onclick="handleMatch('${card.id}', ${card.pairId}, '${card.type}')"
                    ${matchedPairs.includes(card.pairId) ? 'disabled' : ''}>
                    ${card.text}
                  </button>
                `).join('')}
              </div>
              ${matchedPairs.length >= 6 ? `
                <div class="match-complete">
                  <p>üéâ Xu·∫•t s·∫Øc! Con ƒë√£ n·ªëi ƒë√∫ng h·∫øt!</p>
                  <button class="menu-btn play" onclick="startVerbMode('match')">üîÑ Ch∆°i l·∫°i</button>
                </div>
              ` : ''}
            </div>
          `;
          break;
          
        case 'fill':
        case 'test':
          const currentVerb = verbMode === 'test' ? testVerbs[testIndex] : shuffledVerbs[currentVerbIndex];
          html = `
            <div class="verb-fill-mode">
              <div class="verb-fill-header">
                <button class="back-btn" onclick="verbMode='menu';renderVerbScreen()">‚Üê V·ªÅ</button>
                ${verbMode === 'test' ? `<span class="verb-fill-progress">C√¢u ${testIndex + 1} / 10</span>` : ''}
                <span class="verb-fill-score">‚úÖ ${verbScore} / ${verbTotal}</span>
              </div>
              ${verbMode === 'test' ? `
                <div class="progress-bar-container">
                  <div class="progress-bar" style="width:${((testIndex + 1) / 10) * 100}%"></div>
                </div>
              ` : ''}
              <div class="verb-fill-card">
                <h3>${verbMode === 'test' ? 'üìù' : '‚úèÔ∏è'} Vi·∫øt d·∫°ng qu√° kh·ª© c·ªßa:</h3>
                <div class="verb-fill-word">${currentVerb.base}</div>
                <input type="text" class="verb-fill-input" id="verb-input" placeholder="Nh·∫≠p d·∫°ng qu√° kh·ª©..." onkeypress="if(event.key==='Enter')checkVerbFill()">
                <button class="submit-btn" onclick="checkVerbFill()" id="verb-submit" style="width:100%">Ki·ªÉm tra</button>
                <div id="verb-result"></div>
              </div>
            </div>
          `;
          break;
          
        case 'test-result':
          const percentage = Math.round((verbScore / 10) * 100);
          html = `
            <div class="result-screen">
              <div class="result-card">
                <h2 class="result-title">üìù K·∫øt qu·∫£ ki·ªÉm tra</h2>
                <div class="result-emoji">${percentage >= 80 ? 'üèÜ' : percentage >= 50 ? 'üåü' : 'üí™'}</div>
                <div class="stars-display">${'‚≠ê'.repeat(Math.min(3, Math.floor(percentage / 33)))}${'‚òÜ'.repeat(3 - Math.min(3, Math.floor(percentage / 33)))}</div>
                <p class="result-score">ƒêi·ªÉm: <strong>${verbScore} / 10</strong> (${percentage}%)</p>
                <p class="result-message">
                  ${percentage >= 80 ? 'Xu·∫•t s·∫Øc! Con thu·ªôc b√†i r·ªìi! üéä' : percentage >= 50 ? 'T·ªët l·∫Øm! C·∫ßn √¥n th√™m! üí™' : 'C·∫ßn h·ªçc l·∫°i flashcard nha! üìö'}
                </p>
                <div class="result-buttons">
                  <button class="menu-btn play" onclick="startVerbMode('test')">üîÑ Thi l·∫°i</button>
                  <button class="menu-btn learn" onclick="startVerbMode('flashcard')">üé¥ √în Flashcard</button>
                  <button class="menu-btn learn" onclick="verbMode='menu';renderVerbScreen()">‚Üê V·ªÅ menu</button>
                </div>
              </div>
            </div>
          `;
          break;
      }
      
      document.getElementById('verb-screen').innerHTML = html;
    }

    function startVerbMode(mode) {
      verbMode = mode;
      verbScore = 0;
      verbTotal = 0;
      
      if (mode === 'match') {
        const selected = [...IRREGULAR_VERBS].sort(() => Math.random() - 0.5).slice(0, 6);
        const bases = selected.map((v, i) => ({ id: `base-${i}`, text: v.base, type: 'base', pairId: i }));
        const pasts = selected.map((v, i) => ({ id: `past-${i}`, text: v.past, type: 'past', pairId: i }));
        matchPairs = [...bases, ...pasts].sort(() => Math.random() - 0.5);
        selectedMatch = null;
        matchedPairs = [];
      }
      
      if (mode === 'test') {
        testVerbs = [...IRREGULAR_VERBS].sort(() => Math.random() - 0.5).slice(0, 10);
        testIndex = 0;
      }
      
      if (mode === 'flashcard') {
        shuffledVerbs = [...IRREGULAR_VERBS].sort(() => Math.random() - 0.5);
        currentVerbIndex = 0;
        showVerbAnswer = false;
      }
      
      if (mode === 'fill') {
        shuffledVerbs = [...IRREGULAR_VERBS].sort(() => Math.random() - 0.5);
        currentVerbIndex = 0;
      }
      
      renderVerbScreen();
    }

    function flipCard() {
      playSound('flip');
      showVerbAnswer = !showVerbAnswer;
      renderVerbScreen();
    }

    function prevCard() {
      showVerbAnswer = false;
      currentVerbIndex = currentVerbIndex > 0 ? currentVerbIndex - 1 : shuffledVerbs.length - 1;
      renderVerbScreen();
    }

    function nextCard() {
      showVerbAnswer = false;
      currentVerbIndex = currentVerbIndex < shuffledVerbs.length - 1 ? currentVerbIndex + 1 : 0;
      renderVerbScreen();
    }

    function shuffleCards() {
      shuffledVerbs = [...IRREGULAR_VERBS].sort(() => Math.random() - 0.5);
      currentVerbIndex = 0;
      showVerbAnswer = false;
      renderVerbScreen();
    }

    function handleMatch(id, pairId, type) {
      playSound('click');
      
      if (!selectedMatch) {
        selectedMatch = { id, pairId, type };
        renderVerbScreen();
        return;
      }
      
      if (selectedMatch.id === id) {
        selectedMatch = null;
        renderVerbScreen();
        return;
      }
      
      if (selectedMatch.pairId === pairId && selectedMatch.type !== type) {
        matchedPairs.push(pairId);
        selectedMatch = null;
        playSound('match');
        if (matchedPairs.length >= 6) {
          playSound('complete');
          showConfetti();
        }
      } else {
        playSound('wrong');
        selectedMatch = null;
      }
      
      renderVerbScreen();
    }

    function checkVerbFill() {
      const input = document.getElementById('verb-input');
      const currentVerb = verbMode === 'test' ? testVerbs[testIndex] : shuffledVerbs[currentVerbIndex];
      const correct = input.value.toLowerCase().trim() === currentVerb.past.toLowerCase();
      
      verbTotal++;
      if (correct) {
        verbScore++;
        playSound('correct');
      } else {
        playSound('wrong');
      }
      
      input.disabled = true;
      document.getElementById('verb-submit').style.display = 'none';
      
      document.getElementById('verb-result').innerHTML = `
        <div class="verb-fill-result ${correct ? 'correct' : 'wrong'}">
          <p>${correct ? 'üéâ ƒê√∫ng r·ªìi!' : `üí° ƒê√°p √°n: <strong>${currentVerb.base} ‚Üí ${currentVerb.past}</strong>`}</p>
          <button class="next-btn" onclick="nextVerbFill()">
            ${verbMode === 'test' && testIndex >= 9 ? 'Xem k·∫øt qu·∫£ üèÜ' : 'T·ª´ ti·∫øp theo ‚Üí'}
          </button>
        </div>
      `;
    }

    function nextVerbFill() {
      if (verbMode === 'test') {
        if (testIndex < 9) {
          testIndex++;
          renderVerbScreen();
        } else {
          verbMode = 'test-result';
          playSound('complete');
          renderVerbScreen();
        }
      } else {
        currentVerbIndex = currentVerbIndex < shuffledVerbs.length - 1 ? currentVerbIndex + 1 : 0;
        renderVerbScreen();
      }
    }
  </script>
</body>
</html>
